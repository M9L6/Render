(()=>{"use strict";class t{constructor(t=0,s=0){this.values=new Float32Array([t,s])}static create(s=0,e=0){return new t(s,e)}static copy(s,e=null){return null===e&&(e=t.create()),e.values[0]=s.values[0],e.values[1]=s.values[1],e}static sum(s,e,i=null){return null===i&&(i=new t),i.values[0]=s.values[0]+e.values[0],i.values[1]=s.values[1]+e.values[1],i}static difference(s,e,i=null){return null===i&&(i=new t),i.values[0]=s.values[0]-e.values[0],i.values[1]=s.values[1]-e.values[1],i}static scale(s,e,i=null){return null===i&&(i=new t),i.values[0]=s.values[0]*e,i.values[1]=s.values[1]*e,i}static scaleAdd(s,e,i,r=null){return null===r&&(r=new t),r.values[0]=s.values[0]+e.values[0]*i,r.values[1]=s.values[0]+e.values[1]*i,r}static dotProduct(t,s){return t.values[0]*s.values[0]+t.values[1]*s.values[1]}static crossProduct(t,s){return t.values[0]*s.values[1]-t.values[1]*s.values[0]}static getAngle(s,e,i=!1){let r=t.dotProduct(s,e),a=Math.acos(r/(s.length*e.length));return!1===i&&(a=u.toDegree(a)),a}static getOrientation(s,e,i=!1){let r=t.difference(e,s),a=Math.atan2(r.y,r.x);return!1===i&&(a=u.toDegree(a)),a}static sinAngle(t,s,e=!1){return!0===e&&(t.normalize(),s.normalize()),t.x*s.y-s.x*t.y}static cosAngle(s,e,i=!1){return!0===i&&(s.normalize(),e.normalize()),t.dotProduct(s,e)}get x(){return this.values[0]}set x(t){this.values[0]=t}get y(){return this.values[1]}set y(t){this.values[1]=t}toString(){return"("+this.values[0]+","+this.values[1]+")"}reset(t=0,s=0){return this.values[0]=t,this.values[1]=s,this}equals(t){return!(Math.abs(this.values[0]-t.values[0])>Number.EPSILON||Math.abs(this.values[1]-t.values[1])>Number.EPSILON)}get squaredLength(){let t=this.values[0],s=this.values[1];return t*t+s*s}get length(){return Math.sqrt(this.squaredLength)}normalize(){let t=this.length;return u.isEquals(t,0)?(this.values[0]=0,this.values[1]=0,0):u.isEquals(t,1)?1:(this.values[0]/=t,this.values[1],t)}add(s){return t.sum(this,s,this)}substract(s){return t.difference(this,s,this)}negative(){return this.values[0]=-this.values[0],this.values[1]=-this.values[1],this}innerProdcut(s){return t.dotProduct(this,s)}}t.xAxis=new t(1,0),t.nXAxis=new t(-1,0),t.yAxis=new t(0,1),t.nYAxis=new t(0,-1);class s{constructor(t=1,s=0,e=0,i=1,r=0,a=0){this.values=new Float32Array([t,s,e,i,r,a])}static create(t=1,e=0,i=0,r=1,a=0,h=0){return new s(t,e,i,r,a,h)}static copy(t,e=null){return null===e&&(e=new s),e.values[0]=t.values[0],e.values[1]=t.values[1],e.values[2]=t.values[2],e.values[3]=t.values[3],e.values[4]=t.values[4],e.values[5]=t.values[5],e}static multiply(t,e,i=null){null===i&&(i=new s);let r=t.values[0],a=t.values[1],h=t.values[2],l=t.values[3],u=t.values[4],n=t.values[5],o=e.values[0],v=e.values[1],c=e.values[2],x=e.values[3],_=e.values[4],E=e.values[5];return i.values[0]=r*o+h*v,i.values[1]=a*o+l*v,i.values[2]=r*c+h*x,i.values[3]=a*c+l*x,i.values[4]=r*_+h*E+u,i.values[5]=a*_+l*E+n,i}static determinant(t){return t.values[0]*t.values[3]-t.values[1]*t.values[2]}static invert(t,e){let i=s.determinant(t);return!u.isEquals(i,0)&&(i=1/i,e.values[0]=t.values[3]*i,e.values[1]=-t.values[1]*i,e.values[2]=-t.values[2]*i,e.values[3]=t.values[0]*i,e.values[4]=(t.values[2]*t.values[5]-t.values[3]*t.values[4])*i,e.values[5]=(t.values[1]*t.values[4]-t.values[0]*t.values[5])*i,!0)}static makeTranslation(t,e,i=null){return null===i&&(i=new s),i.values[0]=1,i.values[1]=0,i.values[2]=0,i.values[3]=1,i.values[4]=t,i.values[5]=e,i}static makeScale(t,e,i=null){return null===i&&(i=new s),i.values[0]=t,i.values[1]=0,i.values[2]=0,i.values[3]=e,i.values[4]=0,i.values[5]=0,i}static makeRotation(t,e=null){null===e&&(e=new s);let i=Math.sin(t),r=Math.cos(t);return e.values[0]=r,e.values[1]=i,e.values[2]=-i,e.values[3]=r,e.values[4]=0,e.values[5]=0,e}static makeRotationFromVectors(e,i,r=!1,a=null){null===a&&(a=new s);let h=t.cosAngle(e,i,r),l=t.sinAngle(e,i,r);return a.values[0]=l,a.values[1]=h,a.values[2]=-l,a.values[3]=h,a.values[4]=0,a.values[5]=0,a}identity(){this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=1,this.values[4]=0,this.values[5]=0}onlyRotationMatrixInvert(){let t=this.values[1];return this.values[1]=this.values[2],this.values[2]=t,this}}class e{constructor(t){this.values=new Float32Array(4),void 0!==t&&(this.xyzw=t)}get x(){return this.values[0]}get y(){return this.values[1]}get z(){return this.values[2]}get w(){return this.values[3]}get xy(){return[this.values[0],this.values[1]]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}get xyzw(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set z(t){this.values[2]=t}set w(t){this.values[3]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}set xyz(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}set xyzw(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]}get r(){return this.values[0]}get g(){return this.values[1]}get b(){return this.values[2]}get a(){return this.values[3]}get rg(){return[this.values[0],this.values[1]]}get rgb(){return[this.values[0],this.values[1],this.values[2]]}get rgba(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set r(t){this.values[0]=t}set g(t){this.values[1]=t}set b(t){this.values[2]=t}set a(t){this.values[3]=t}set rg(t){this.values[0]=t[0],this.values[1]=t[1]}set rgb(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}set rgba(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]}get Values(){return this.values}at(t){return this.values[t]}reset(){this.x=0,this.y=0,this.z=0,this.w=0}copy(t){return t||(t=new e),t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t}negate(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=-this.w,t}equals(t,s=1e-5){return!(Math.abs(this.x-t.x)>s||Math.abs(this.y-t.y)>s||Math.abs(this.z-t.z)>s||Math.abs(this.w-t.w)>s)}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.x,s=this.y,e=this.z,i=this.w;return t*t+s*s+e*e+i*i}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}scale(t,s){return s||(s=this),s.x*=t,s.y*=t,s.z*=t,s.w*=t,s}normalize(t){t||(t=this);let s=this.length();return 1===s?this:0===s?(t.x*=0,t.y*=0,t.z*=0,t.w*=0,t):(s=1/s,t.x*=s,t.y*=s,t.z*=s,t.w*=s,t)}multiplyMat4(t,s){return s||(s=this),t.multiplyVec4(this,s)}static mix(t,s,i,r){return r||(r=new e),r.x=t.x+i*(s.x-t.x),r.y=t.y+i*(s.y-t.y),r.z=t.z+i*(s.z-t.z),r.w=t.w+i*(s.w-t.w),r}static sum(t,s,i){return i||(i=new e),i.x=t.x+s.x,i.y=t.y+s.y,i.z=t.z+s.z,i.w=t.w+s.w,i}static difference(t,s,i){return i||(i=new e),i.x=t.x-s.x,i.y=t.y-s.y,i.z=t.z-s.z,i.w=t.w-s.w,i}static product(t,s,i){return i||(i=new e),i.x=t.x*s.x,i.y=t.y*s.y,i.z=t.z*s.z,i.w=t.w*s.w,i}static quotient(t,s,i){return i||(i=new e),i.x=t.x/s.x,i.y=t.y/s.y,i.z=t.z/s.z,i.w=t.w/s.w,i}}e.zero=new e([0,0,0,1]),e.one=new e([1,1,1,1]);class i{constructor(t){this.values=new Float32Array(16),void 0!==t&&this.init(t)}get Values(){return this.values}at(t){return this.values[t]}init(t){for(let s=0;s<16;s++)this.values[s]=t[s];return this}reset(){for(let t=0;t<16;t++)this.values[t]=0}copy(t){t||(t=new i);for(let s=0;s<16;s++)t.values[s]=this.values[s];return t}all(){const t=[];for(let s=0;s<16;s++)t[s]=this.values[s];return t}row(t){return[this.values[4*t+0],this.values[4*t+1],this.values[4*t+2],this.values[4*t+3]]}col(t){return[this.values[t],this.values[t+4],this.values[t+8],this.values[t+12]]}equals(t,s=1e-5){for(let e=0;e<16;e++)if(Math.abs(this.values[e]-t.at(e))>s)return!1;return!0}determinant(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],r=this.values[4],a=this.values[5],h=this.values[6],l=this.values[7],u=this.values[8],n=this.values[9],o=this.values[10],v=this.values[11],c=this.values[12],x=this.values[13],_=this.values[14],E=this.values[15];return(t*a-s*r)*(o*E-v*_)-(t*h-e*r)*(n*E-v*x)+(t*l-i*r)*(n*_-o*x)+(s*h-e*a)*(u*E-v*c)-(s*l-i*a)*(u*_-o*c)+(e*l-i*h)*(u*x-n*c)}setIdentity(){return this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=0,this.values[4]=0,this.values[5]=1,this.values[6]=0,this.values[7]=0,this.values[8]=0,this.values[9]=0,this.values[10]=1,this.values[11]=0,this.values[12]=0,this.values[13]=0,this.values[14]=0,this.values[15]=1,this}transpose(){const t=this.values[1],s=this.values[2],e=this.values[3],i=this.values[6],r=this.values[7],a=this.values[11];return this.values[1]=this.values[4],this.values[2]=this.values[8],this.values[3]=this.values[12],this.values[4]=t,this.values[6]=this.values[9],this.values[7]=this.values[13],this.values[8]=s,this.values[9]=i,this.values[11]=this.values[14],this.values[12]=e,this.values[13]=r,this.values[14]=a,this}inverse(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],r=this.values[4],a=this.values[5],h=this.values[6],l=this.values[7],u=this.values[8],n=this.values[9],o=this.values[10],v=this.values[11],c=this.values[12],x=this.values[13],_=this.values[14],E=this.values[15],d=t*a-s*r,A=t*h-e*r,y=t*l-i*r,g=s*h-e*a,O=s*l-i*a,T=e*l-i*h,w=u*x-n*c,M=u*_-o*c,m=u*E-v*c,N=n*_-o*x,p=n*E-v*x,f=o*E-v*_;let R=d*f-A*p+y*N+g*m-O*M+T*w;return R?(R=1/R,this.values[0]=(a*f-h*p+l*N)*R,this.values[1]=(-s*f+e*p-i*N)*R,this.values[2]=(x*T-_*O+E*g)*R,this.values[3]=(-n*T+o*O-v*g)*R,this.values[4]=(-r*f+h*m-l*M)*R,this.values[5]=(t*f-e*m+i*M)*R,this.values[6]=(-c*T+_*y-E*A)*R,this.values[7]=(u*T-o*y+v*A)*R,this.values[8]=(r*p-a*m+l*w)*R,this.values[9]=(-t*p+s*m-i*w)*R,this.values[10]=(c*O-x*y+E*d)*R,this.values[11]=(-u*O+n*y-v*d)*R,this.values[12]=(-r*N+a*M-h*w)*R,this.values[13]=(t*N-s*M+e*w)*R,this.values[14]=(-c*g+x*A-_*d)*R,this.values[15]=(u*g-n*A+o*d)*R,this):null}multiply(t){const s=this.values[0],e=this.values[1],i=this.values[2],r=this.values[3],a=this.values[4],h=this.values[5],l=this.values[6],u=this.values[7],n=this.values[8],o=this.values[9],v=this.values[10],c=this.values[11],x=this.values[12],_=this.values[13],E=this.values[14],d=this.values[15];let A=t.at(0),y=t.at(1),g=t.at(2),O=t.at(3);return this.values[0]=A*s+y*a+g*n+O*x,this.values[1]=A*e+y*h+g*o+O*_,this.values[2]=A*i+y*l+g*v+O*E,this.values[3]=A*r+y*u+g*c+O*d,A=t.at(4),y=t.at(5),g=t.at(6),O=t.at(7),this.values[4]=A*s+y*a+g*n+O*x,this.values[5]=A*e+y*h+g*o+O*_,this.values[6]=A*i+y*l+g*v+O*E,this.values[7]=A*r+y*u+g*c+O*d,A=t.at(8),y=t.at(9),g=t.at(10),O=t.at(11),this.values[8]=A*s+y*a+g*n+O*x,this.values[9]=A*e+y*h+g*o+O*_,this.values[10]=A*i+y*l+g*v+O*E,this.values[11]=A*r+y*u+g*c+O*d,A=t.at(12),y=t.at(13),g=t.at(14),O=t.at(15),this.values[12]=A*s+y*a+g*n+O*x,this.values[13]=A*e+y*h+g*o+O*_,this.values[14]=A*i+y*l+g*v+O*E,this.values[15]=A*r+y*u+g*c+O*d,this}multiplyVec3(t,s){s||(s=new l);const e=t.x,i=t.y,r=t.z;return s.x=this.values[0]*e+this.values[4]*i+this.values[8]*r+this.values[12],s.y=this.values[1]*e+this.values[5]*i+this.values[9]*r+this.values[13],s.z=this.values[2]*e+this.values[6]*i+this.values[10]*r+this.values[14],s}multiplyVec4(t,s){s||(s=new e);const i=t.x,r=t.y,a=t.z,h=t.w;return s.x=this.values[0]*i+this.values[4]*r+this.values[8]*a+this.values[12]*h,s.y=this.values[1]*i+this.values[5]*r+this.values[9]*a+this.values[13]*h,s.z=this.values[2]*i+this.values[6]*r+this.values[10]*a+this.values[14]*h,s.w=this.values[3]*i+this.values[7]*r+this.values[11]*a+this.values[15]*h,s}toMat3(){return new a([this.values[0],this.values[1],this.values[2],this.values[4],this.values[5],this.values[6],this.values[8],this.values[9],this.values[10]])}toInverseMat3(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[4],r=this.values[5],h=this.values[6],l=this.values[8],u=this.values[9],n=this.values[10],o=n*r-h*u,v=-n*i+h*l,c=u*i-r*l;let x=t*o+s*v+e*c;return x?(x=1/x,new a([o*x,(-n*s+e*u)*x,(h*s-e*r)*x,v*x,(n*t-e*l)*x,(-h*t+e*i)*x,c*x,(-u*t+s*l)*x,(r*t-s*i)*x])):null}translate(t){const s=t.x,e=t.y,i=t.z;return this.values[12]+=this.values[0]*s+this.values[4]*e+this.values[8]*i,this.values[13]+=this.values[1]*s+this.values[5]*e+this.values[9]*i,this.values[14]+=this.values[2]*s+this.values[6]*e+this.values[10]*i,this.values[15]+=this.values[3]*s+this.values[7]*e+this.values[11]*i,this}scale(t){const s=t.x,e=t.y,i=t.z;return this.values[0]*=s,this.values[1]*=s,this.values[2]*=s,this.values[3]*=s,this.values[4]*=e,this.values[5]*=e,this.values[6]*=e,this.values[7]*=e,this.values[8]*=i,this.values[9]*=i,this.values[10]*=i,this.values[11]*=i,this}rotate(t,s){let e=s.x,i=s.y,r=s.z,a=Math.sqrt(e*e+i*i+r*r);if(!a)return null;1!==a&&(a=1/a,e*=a,i*=a,r*=a);const h=Math.sin(t),l=Math.cos(t),u=1-l,n=this.values[0],o=this.values[1],v=this.values[2],c=this.values[3],x=this.values[4],_=this.values[5],E=this.values[6],d=this.values[7],A=this.values[8],y=this.values[9],g=this.values[10],O=this.values[11],T=e*e*u+l,w=i*e*u+r*h,M=r*e*u-i*h,m=e*i*u-r*h,N=i*i*u+l,p=r*i*u+e*h,f=e*r*u+i*h,R=i*r*u-e*h,b=r*r*u+l;return this.values[0]=n*T+x*w+A*M,this.values[1]=o*T+_*w+y*M,this.values[2]=v*T+E*w+g*M,this.values[3]=c*T+d*w+O*M,this.values[4]=n*m+x*N+A*p,this.values[5]=o*m+_*N+y*p,this.values[6]=v*m+E*N+g*p,this.values[7]=c*m+d*N+O*p,this.values[8]=n*f+x*R+A*b,this.values[9]=o*f+_*R+y*b,this.values[10]=v*f+E*R+g*b,this.values[11]=c*f+d*R+O*b,this}static frustum(t,s,e,r,a,h){const l=s-t,u=r-e,n=h-a;return new i([2*a/l,0,0,0,0,2*a/u,0,0,(s+t)/l,(r+e)/u,-(h+a)/n,-1,0,0,-h*a*2/n,0])}static perspective(t,s,e,r){const a=e*Math.tan(t*Math.PI/360),h=a*s;return i.frustum(-h,h,-a,a,e,r)}static orthographic(t,s,e,r,a,h){const l=s-t,u=r-e,n=h-a;return new i([2/l,0,0,0,0,2/u,0,0,0,0,-2/n,0,-(t+s)/l,-(r+e)/u,-(h+a)/n,1])}static lookAt(t,s,e=l.up){if(t.equals(s))return this.identity;const r=l.difference(t,s).normalize(),a=l.cross(e,r).normalize(),h=l.cross(r,a).normalize();return new i([a.x,h.x,r.x,0,a.y,h.y,r.y,0,a.z,h.z,r.z,0,-l.dot(a,t),-l.dot(h,t),-l.dot(r,t),1])}static product(t,s,e){const r=t.at(0),a=t.at(1),h=t.at(2),l=t.at(3),u=t.at(4),n=t.at(5),o=t.at(6),v=t.at(7),c=t.at(8),x=t.at(9),_=t.at(10),E=t.at(11),d=t.at(12),A=t.at(13),y=t.at(14),g=t.at(15),O=s.at(0),T=s.at(1),w=s.at(2),M=s.at(3),m=s.at(4),N=s.at(5),p=s.at(6),f=s.at(7),R=s.at(8),b=s.at(9),C=s.at(10),S=s.at(11),L=s.at(12),I=s.at(13),P=s.at(14),z=s.at(15);return e?(e.init([O*r+T*u+w*c+M*d,O*a+T*n+w*x+M*A,O*h+T*o+w*_+M*y,O*l+T*v+w*E+M*g,m*r+N*u+p*c+f*d,m*a+N*n+p*x+f*A,m*h+N*o+p*_+f*y,m*l+N*v+p*E+f*g,R*r+b*u+C*c+S*d,R*a+b*n+C*x+S*A,R*h+b*o+C*_+S*y,R*l+b*v+C*E+S*g,L*r+I*u+P*c+z*d,L*a+I*n+P*x+z*A,L*h+I*o+P*_+z*y,L*l+I*v+P*E+z*g]),e):new i([O*r+T*u+w*c+M*d,O*a+T*n+w*x+M*A,O*h+T*o+w*_+M*y,O*l+T*v+w*E+M*g,m*r+N*u+p*c+f*d,m*a+N*n+p*x+f*A,m*h+N*o+p*_+f*y,m*l+N*v+p*E+f*g,R*r+b*u+C*c+S*d,R*a+b*n+C*x+S*A,R*h+b*o+C*_+S*y,R*l+b*v+C*E+S*g,L*r+I*u+P*c+z*d,L*a+I*n+P*x+z*A,L*h+I*o+P*_+z*y,L*l+I*v+P*E+z*g])}}i.identity=(new i).setIdentity();class r{constructor(t){this.values=new Float32Array(2),void 0!==t&&(this.xy=t)}get x(){return this.values[0]}get y(){return this.values[1]}get xy(){return[this.values[0],this.values[1]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}get Values(){return this.values}at(t){return this.values[t]}reset(){this.x=0,this.y=0}copy(t){return t||(t=new r),t.x=this.x,t.y=this.y,t}negate(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t}equals(t,s=1e-5){return!(Math.abs(this.x-t.x)>s||Math.abs(this.y-t.y)>s)}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.x,s=this.y;return t*t+s*s}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}divide(t){return this.x/=t.x,this.y/=t.y,this}scale(t,s){return s||(s=this),s.x*=t,s.y*=t,s}normalize(t){t||(t=this);let s=this.length();return 1===s?this:0===s?(t.x=0,t.y=0,t):(s=1/s,t.x*=s,t.y*=s,t)}multiplyMat2(t,s){return s||(s=this),t.multiplyVec2(this,s)}multiplyMat3(t,s){return s||(s=this),t.multiplyVec2(this,s)}static cross(t,s,e){e||(e=new l);const i=t.x,r=t.y,a=s.x,h=i*s.y-r*a;return e.x=0,e.y=0,e.z=h,e}static dot(t,s){return t.x*s.x+t.y*s.y}static distance(t,s){return Math.sqrt(this.squaredDistance(t,s))}static squaredDistance(t,s){const e=s.x-t.x,i=s.y-t.y;return e*e+i*i}static direction(t,s,e){e||(e=new r);const i=t.x-s.x,a=t.y-s.y;let h=Math.sqrt(i*i+a*a);return 0===h?(e.x=0,e.y=0,e):(h=1/h,e.x=i*h,e.y=a*h,e)}static mix(t,s,e,i){i||(i=new r);const a=t.x,h=t.y,l=s.x,u=s.y;return i.x=a+e*(l-a),i.y=h+e*(u-h),i}static sum(t,s,e){return e||(e=new r),e.x=t.x+s.x,e.y=t.y+s.y,e}static difference(t,s,e){return e||(e=new r),e.x=t.x-s.x,e.y=t.y-s.y,e}static product(t,s,e){return e||(e=new r),e.x=t.x*s.x,e.y=t.y*s.y,e}static quotient(t,s,e){return e||(e=new r),e.x=t.x/s.x,e.y=t.y/s.y,e}}r.zero=new r([0,0]),r.one=new r([1,1]);class a{constructor(t){this.values=new Float32Array(9),void 0!==t&&this.init(t)}get Values(){return this.values}at(t){return this.values[t]}init(t){for(let s=0;s<9;s++)this.values[s]=t[s];return this}reset(){for(let t=0;t<9;t++)this.values[t]=0}copy(t){t||(t=new a);for(let s=0;s<9;s++)t.values[s]=this.values[s];return t}all(){const t=[];for(let s=0;s<9;s++)t[s]=this.values[s];return t}row(t){return[this.values[3*t+0],this.values[3*t+1],this.values[3*t+2]]}col(t){return[this.values[t],this.values[t+3],this.values[t+6]]}equals(t,s=1e-5){for(let e=0;e<9;e++)if(Math.abs(this.values[e]-t.at(e))>s)return!1;return!0}determinant(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],r=this.values[4],a=this.values[5],h=this.values[6],l=this.values[7],u=this.values[8];return t*(u*r-a*l)+s*(-u*i+a*h)+e*(l*i-r*h)}setIdentity(){return this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=0,this.values[4]=1,this.values[5]=0,this.values[6]=0,this.values[7]=0,this.values[8]=1,this}transpose(){const t=this.values[1],s=this.values[2],e=this.values[5];return this.values[1]=this.values[3],this.values[2]=this.values[6],this.values[3]=t,this.values[5]=this.values[7],this.values[6]=s,this.values[7]=e,this}inverse(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],r=this.values[4],a=this.values[5],h=this.values[6],l=this.values[7],u=this.values[8],n=u*r-a*l,o=-u*i+a*h,v=l*i-r*h;let c=t*n+s*o+e*v;return c?(c=1/c,this.values[0]=n*c,this.values[1]=(-u*s+e*l)*c,this.values[2]=(a*s-e*r)*c,this.values[3]=o*c,this.values[4]=(u*t-e*h)*c,this.values[5]=(-a*t+e*i)*c,this.values[6]=v*c,this.values[7]=(-l*t+s*h)*c,this.values[8]=(r*t-s*i)*c,this):null}multiply(t){const s=this.values[0],e=this.values[1],i=this.values[2],r=this.values[3],a=this.values[4],h=this.values[5],l=this.values[6],u=this.values[7],n=this.values[8],o=t.at(0),v=t.at(1),c=t.at(2),x=t.at(3),_=t.at(4),E=t.at(5),d=t.at(6),A=t.at(7),y=t.at(8);return this.values[0]=o*s+v*r+c*l,this.values[1]=o*e+v*a+c*u,this.values[2]=o*i+v*h+c*n,this.values[3]=x*s+_*r+E*l,this.values[4]=x*e+_*a+E*u,this.values[5]=x*i+_*h+E*n,this.values[6]=d*s+A*r+y*l,this.values[7]=d*e+A*a+y*u,this.values[8]=d*i+A*h+y*n,this}multiplyVec2(t,s){const e=t.x,i=t.y;return s?(s.xy=[e*this.values[0]+i*this.values[3]+this.values[6],e*this.values[1]+i*this.values[4]+this.values[7]],s):new r([e*this.values[0]+i*this.values[3]+this.values[6],e*this.values[1]+i*this.values[4]+this.values[7]])}multiplyVec3(t,s){const e=t.x,i=t.y,r=t.z;return s?(s.xyz=[e*this.values[0]+i*this.values[3]+r*this.values[6],e*this.values[1]+i*this.values[4]+r*this.values[7],e*this.values[2]+i*this.values[5]+r*this.values[8]],s):new l([e*this.values[0]+i*this.values[3]+r*this.values[6],e*this.values[1]+i*this.values[4]+r*this.values[7],e*this.values[2]+i*this.values[5]+r*this.values[8]])}toMat4(t){return t?(t.init([this.values[0],this.values[1],this.values[2],0,this.values[3],this.values[4],this.values[5],0,this.values[6],this.values[7],this.values[8],0,0,0,0,1]),t):new i([this.values[0],this.values[1],this.values[2],0,this.values[3],this.values[4],this.values[5],0,this.values[6],this.values[7],this.values[8],0,0,0,0,1])}toQuat(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],r=this.values[4],a=this.values[5],l=this.values[6],u=this.values[7],n=this.values[8],o=t-r-n,v=r-t-n,c=n-t-r;let x=0,_=t+r+n;o>_&&(_=o,x=1),v>_&&(_=v,x=2),c>_&&(_=c,x=3);const E=.5*Math.sqrt(_+1),d=.25/E,A=new h;switch(x){case 0:A.w=E,A.x=(a-u)*d,A.y=(l-e)*d,A.z=(s-i)*d;break;case 1:A.w=(a-u)*d,A.x=E,A.y=(s+i)*d,A.z=(l+e)*d;break;case 2:A.w=(l-e)*d,A.x=(s+i)*d,A.y=E,A.z=(a+u)*d;break;case 3:A.w=(s-i)*d,A.x=(l+e)*d,A.y=(a+u)*d,A.z=E}return A}rotate(t,s){let e=s.x,i=s.y,r=s.z,a=Math.sqrt(e*e+i*i+r*r);if(!a)return null;1!==a&&(a=1/a,e*=a,i*=a,r*=a);const h=Math.sin(t),l=Math.cos(t),u=1-l,n=this.values[0],o=this.values[1],v=this.values[2],c=this.values[4],x=this.values[5],_=this.values[6],E=this.values[8],d=this.values[9],A=this.values[10],y=e*e*u+l,g=i*e*u+r*h,O=r*e*u-i*h,T=e*i*u-r*h,w=i*i*u+l,M=r*i*u+e*h,m=e*r*u+i*h,N=i*r*u-e*h,p=r*r*u+l;return this.values[0]=n*y+c*g+E*O,this.values[1]=o*y+x*g+d*O,this.values[2]=v*y+_*g+A*O,this.values[3]=n*T+c*w+E*M,this.values[4]=o*T+x*w+d*M,this.values[5]=v*T+_*w+A*M,this.values[6]=n*m+c*N+E*p,this.values[7]=o*m+x*N+d*p,this.values[8]=v*m+_*N+A*p,this}static product(t,s,e){const i=t.at(0),r=t.at(1),h=t.at(2),l=t.at(3),u=t.at(4),n=t.at(5),o=t.at(6),v=t.at(7),c=t.at(8),x=s.at(0),_=s.at(1),E=s.at(2),d=s.at(3),A=s.at(4),y=s.at(5),g=s.at(6),O=s.at(7),T=s.at(8);return e?(e.init([x*i+_*l+E*o,x*r+_*u+E*v,x*h+_*n+E*c,d*i+A*l+y*o,d*r+A*u+y*v,d*h+A*n+y*c,g*i+O*l+T*o,g*r+O*u+T*v,g*h+O*n+T*c]),e):new a([x*i+_*l+E*o,x*r+_*u+E*v,x*h+_*n+E*c,d*i+A*l+y*o,d*r+A*u+y*v,d*h+A*n+y*c,g*i+O*l+T*o,g*r+O*u+T*v,g*h+O*n+T*c])}}a.identity=(new a).setIdentity();class h{constructor(t){this.values=new Float32Array(4),void 0!==t&&(this.xyzw=t)}get x(){return this.values[0]}get y(){return this.values[1]}get z(){return this.values[2]}get w(){return this.values[3]}get xy(){return[this.values[0],this.values[1]]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}get xyzw(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set z(t){this.values[2]=t}set w(t){this.values[3]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}set xyz(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}set xyzw(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]}get Values(){return this.values}at(t){return this.values[t]}reset(){for(let t=0;t<4;t++)this.values[t]=0}copy(t){t||(t=new h);for(let s=0;s<4;s++)t.values[s]=this.values[s];return t}roll(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.atan2(2*(t*s+i*e),i*i+t*t-s*s-e*e)}pitch(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.atan2(2*(s*e+i*t),i*i-t*t-s*s+e*e)}yaw(){return Math.asin(2*(this.x*this.z-this.w*this.y))}equals(t,s=1e-5){for(let e=0;e<4;e++)if(Math.abs(this.values[e]-t.at(e))>s)return!1;return!0}setIdentity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}calculateW(){const t=this.x,s=this.y,e=this.z;return this.w=-Math.sqrt(Math.abs(1-t*t-s*s-e*e)),this}inverse(){const t=h.dot(this,this);if(!t)return this.xyzw=[0,0,0,0],this;const s=t?1/t:0;return this.x*=-s,this.y*=-s,this.z*=-s,this.w*=s,this}conjugate(){return this.values[0]*=-1,this.values[1]*=-1,this.values[2]*=-1,this}length(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.sqrt(t*t+s*s+e*e+i*i)}normalize(t){t||(t=this);const s=this.x,e=this.y,i=this.z,r=this.w;let a=Math.sqrt(s*s+e*e+i*i+r*r);return a?(a=1/a,t.x=s*a,t.y=e*a,t.z=i*a,t.w=r*a,t):(t.x=0,t.y=0,t.z=0,t.w=0,t)}add(t){for(let s=0;s<4;s++)this.values[s]+=t.at(s);return this}multiply(t){const s=this.values[0],e=this.values[1],i=this.values[2],r=this.values[3],a=t.x,h=t.y,l=t.z,u=t.w;return this.x=s*u+r*a+e*l-i*h,this.y=e*u+r*h+i*a-s*l,this.z=i*u+r*l+s*h-e*a,this.w=r*u-s*a-e*h-i*l,this}multiplyVec3(t,s){s||(s=new l);const e=t.x,i=t.y,r=t.z,a=this.x,h=this.y,u=this.z,n=this.w,o=n*e+h*r-u*i,v=n*i+u*e-a*r,c=n*r+a*i-h*e,x=-a*e-h*i-u*r;return s.x=o*n+x*-a+v*-u-c*-h,s.y=v*n+x*-h+c*-a-o*-u,s.z=c*n+x*-u+o*-h-v*-a,s}toMat3(t){t||(t=new a);const s=this.x,e=this.y,i=this.z,r=this.w,h=s+s,l=e+e,u=i+i,n=s*h,o=s*l,v=s*u,c=e*l,x=e*u,_=i*u,E=r*h,d=r*l,A=r*u;return t.init([1-(c+_),o+A,v-d,o-A,1-(n+_),x+E,v+d,x-E,1-(n+c)]),t}toMat4(t){t||(t=new i);const s=this.x,e=this.y,r=this.z,a=this.w,h=s+s,l=e+e,u=r+r,n=s*h,o=s*l,v=s*u,c=e*l,x=e*u,_=r*u,E=a*h,d=a*l,A=a*u;return t.init([1-(c+_),o+A,v-d,0,o-A,1-(n+_),x+E,0,v+d,x-E,1-(n+c),0,0,0,0,1]),t}static dot(t,s){return t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w}static sum(t,s,e){return e||(e=new h),e.x=t.x+s.x,e.y=t.y+s.y,e.z=t.z+s.z,e.w=t.w+s.w,e}static product(t,s,e){e||(e=new h);const i=t.x,r=t.y,a=t.z,l=t.w,u=s.x,n=s.y,o=s.z,v=s.w;return e.x=i*v+l*u+r*o-a*n,e.y=r*v+l*n+a*u-i*o,e.z=a*v+l*o+i*n-r*u,e.w=l*v-i*u-r*n-a*o,e}static cross(t,s,e){e||(e=new h);const i=t.x,r=t.y,a=t.z,l=t.w,u=s.x,n=s.y,o=s.z,v=s.w;return e.x=l*o+a*v+i*n-r*u,e.y=l*v-i*u-r*n-a*o,e.z=l*u+i*v+r*o-a*n,e.w=l*n+r*v+a*u-i*o,e}static shortMix(t,s,e,i){if(i||(i=new h),e<=0)return i.xyzw=t.xyzw,i;if(e>=1)return i.xyzw=s.xyzw,i;let r=h.dot(t,s);const a=s.copy();let l,u;if(r<0&&(a.inverse(),r=-r),r>.9999)l=1-e,u=0+e;else{const t=Math.sqrt(1-r*r),s=Math.atan2(t,r),i=1/t;l=Math.sin((1-e)*s)*i,u=Math.sin((0+e)*s)*i}return i.x=l*t.x+u*a.x,i.y=l*t.y+u*a.y,i.z=l*t.z+u*a.z,i.w=l*t.w+u*a.w,i}static mix(t,s,e,i){i||(i=new h);const r=t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w;if(Math.abs(r)>=1)return i.xyzw=t.xyzw,i;const a=Math.acos(r),l=Math.sqrt(1-r*r);if(Math.abs(l)<.001)return i.x=.5*t.x+.5*s.x,i.y=.5*t.y+.5*s.y,i.z=.5*t.z+.5*s.z,i.w=.5*t.w+.5*s.w,i;const u=Math.sin((1-e)*a)/l,n=Math.sin(e*a)/l;return i.x=t.x*u+s.x*n,i.y=t.y*u+s.y*n,i.z=t.z*u+s.z*n,i.w=t.w*u+s.w*n,i}static fromAxisAngle(t,s,e){e||(e=new h),s*=.5;const i=Math.sin(s);return e.x=t.x*i,e.y=t.y*i,e.z=t.z*i,e.w=Math.cos(s),e}}h.identity=(new h).setIdentity();class l{constructor(t){this.values=new Float32Array(3),void 0!==t&&(this.xyz=t)}get x(){return this.values[0]}get y(){return this.values[1]}get z(){return this.values[2]}get xy(){return[this.values[0],this.values[1]]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set z(t){this.values[2]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}set xyz(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}get Values(){return this.values}at(t){return this.values[t]}reset(){this.x=0,this.y=0,this.z=0}copy(t){return t||(t=new l),t.x=this.x,t.y=this.y,t.z=this.z,t}negate(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}equals(t,s=1e-5){return!(Math.abs(this.x-t.x)>s||Math.abs(this.y-t.y)>s||Math.abs(this.z-t.z)>s)}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.x,s=this.y,e=this.z;return t*t+s*s+e*e}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}scale(t,s){return s||(s=this),s.x*=t,s.y*=t,s.z*=t,s}normalize(t){t||(t=this);let s=this.length();return 1===s?this:0===s?(t.x=0,t.y=0,t.z=0,t):(s=1/s,t.x*=s,t.y*=s,t.z*=s,t)}multiplyByMat3(t,s){return s||(s=this),t.multiplyVec3(this,s)}multiplyByQuat(t,s){return s||(s=this),t.multiplyVec3(this,s)}toQuat(t){t||(t=new h);const s=new l,e=new l;return s.x=Math.cos(.5*this.x),e.x=Math.sin(.5*this.x),s.y=Math.cos(.5*this.y),e.y=Math.sin(.5*this.y),s.z=Math.cos(.5*this.z),e.z=Math.sin(.5*this.z),t.x=e.x*s.y*s.z-s.x*e.y*e.z,t.y=s.x*e.y*s.z+e.x*s.y*e.z,t.z=s.x*s.y*e.z-e.x*e.y*s.z,t.w=s.x*s.y*s.z+e.x*e.y*e.z,t}static cross(t,s,e){e||(e=new l);const i=t.x,r=t.y,a=t.z,h=s.x,u=s.y,n=s.z;return e.x=r*n-a*u,e.y=a*h-i*n,e.z=i*u-r*h,e}static dot(t,s){const e=t.x,i=t.y,r=t.z;return e*s.x+i*s.y+r*s.z}static distance(t,s){return s.x,t.x,s.y,t.y,s.z,t.z,Math.sqrt(this.squaredDistance(t,s))}static squaredDistance(t,s){const e=s.x-t.x,i=s.y-t.y,r=s.z-t.z;return e*e+i*i+r*r}static direction(t,s,e){e||(e=new l);const i=t.x-s.x,r=t.y-s.y,a=t.z-s.z;let h=Math.sqrt(i*i+r*r+a*a);return 0===h?(e.x=0,e.y=0,e.z=0,e):(h=1/h,e.x=i*h,e.y=r*h,e.z=a*h,e)}static mix(t,s,e,i){return i||(i=new l),i.x=t.x+e*(s.x-t.x),i.y=t.y+e*(s.y-t.y),i.z=t.z+e*(s.z-t.z),i}static sum(t,s,e){return e||(e=new l),e.x=t.x+s.x,e.y=t.y+s.y,e.z=t.z+s.z,e}static difference(t,s,e){return e||(e=new l),e.x=t.x-s.x,e.y=t.y-s.y,e.z=t.z-s.z,e}static product(t,s,e){return e||(e=new l),e.x=t.x*s.x,e.y=t.y*s.y,e.z=t.z*s.z,e}static quotient(t,s,e){return e||(e=new l),e.x=t.x/s.x,e.y=t.y/s.y,e.z=t.z/s.z,e}}l.zero=new l([0,0,0]),l.one=new l([1,1,1]),l.up=new l([0,1,0]),l.right=new l([1,0,0]),l.forward=new l([0,0,1]);class u{static toRadian(t){return t/180*Math.PI}static toDegree(t){return 180*t/Math.PI}static random(t,s){return t+Math.random()*(s-t)}static isEquals(t,s){return!(Math.abs(t-s)>Number.EPSILON)}static projectPointOnLineSegment(s,e,i,r){let a=t.create(),h=t.create(),l=0;t.difference(s,e,a),t.difference(i,e,h),l=h.normalize();let u=t.dotProduct(a,h);return u<0?(r.x=e.x,r.y=e.y,!1):u>l?(r.x=i.x,r.y=i.y,!1):(t.scaleAdd(e,h,u,r),!0)}static isPointInCircle(s,e,i){return t.difference(e,s).squaredLength<=i*i}static isPointOnLineSegement(s,e,i,r=2){let a=t.create();return!1!==u.projectPointOnLineSegment(s,e,i,a)&&u.isPointInCircle(s,a,r)}static isPointInRect(t,s,e,i,r,a){return t>=e&&t<=e+r&&s>=i&&s<=i+a}static isPointInEllipse(t,s,e,i,r,a){let h=t-e,l=s-i;return h*h/(r*r)+l*l/(a*a)<=1}static sign(s,e,i){let r=t.difference(s,i),a=t.difference(e,i);return t.crossProduct(r,a)}static isPointInTriangle(t,s,e,i){let r=u.sign(s,e,t)<0,a=u.sign(e,i,t)<0,h=u.sign(i,s,t)<0;return r===a&&a===h}static isPointInPolygon(t,s){if(s.length<3)return!1;for(let e=2;e<s.length;e++)if(u.isPointInTriangle(t,s[0],s[e-1],s[e]))return!0;return!1}static isConvex(t){let s,e,i=u.sign(t[0],t[1],t[2])<0;for(let r=1;r<t.length;r++)if(s=(r+1)%t.length,e=(r+2)%t.length,i!==u.sign(t[r],t[s],t[e])<0)return!1;return!0}static transform(s,e,i=null){return null===i&&(i=new t),i.values[0]=s.values[0]*e.values[0]+s.values[2]*e.values[1]+s.values[4],i.values[1]=s.values[1]*e.values[0]+s.values[3]*e.values[1]+s.values[5],i}static getQuadraticBezierPosition(t,s,e,i){if(i<0||i>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");let r=1-i;return r*r*t+2*i*r*s+i*i*e}static getQuadraticBezierVector(s,e,i,r,a=null){if(r<0||r>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");return null===a&&(a=new t),a.x=u.getQuadraticBezierPosition(s.x,e.x,i.x,r),a.y=u.getQuadraticBezierPosition(s.y,e.y,i.y,r),a}static getCubicBezierPosition(t,s,e,i,r){if(r<0||r>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");let a=1-r,h=r*r;return a*a*a*t+3*r*a*a*s+3*h*a*e+h*r*i}static getCubicBezierVector(s,e,i,r,a,h=null){if(a<0||a>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");return null===h&&(h=new t),h.x=u.getCubicBezierPosition(s.x,e.x,i.x,r.x,a),h.y=u.getCubicBezierPosition(s.y,e.y,i.y,r.y,a),h}static computeNormal(t,s,e,i){i||(i=new l);let r=new l,a=new l;return l.difference(s,t,r),l.difference(e,t,a),l.cross(r,a,i),i.normalize(),i}}u.Colors=["aqua","black","blue","fuchsia","gray","green","lime","maroon","navy","olive","orange","purple","red","silver","teal","white","yellow"],u.matStack=new class{constructor(){this._mats=[],this._mats.push(new s)}get matrix(){if(0===this._mats.length)throw alert("矩阵堆栈为空"),new Error("矩阵堆栈为空");return this._mats[this._mats.length-1]}pushMatrix(){let t=s.copy(this.matrix);this._mats.push(t)}popMatrix(){0!==this._mats.length?this._mats.pop():alert("堆栈为空")}loadIdentity(){this.matrix.identity()}loadMatrix(t){s.copy(t,this.matrix)}multMatrix(t){s.multiply(this.matrix,t,this.matrix)}translate(t=0,e=0){let i=s.makeTranslation(t,e);this.multMatrix(i)}rotate(t=0,e=!0){!1===e&&(t=u.toRadian(t));let i=s.makeRotation(t);this.multMatrix(i)}rotateFrom(t,e,i=!1){let r=s.makeRotationFromVectors(t,e,i);this.multMatrix(r)}scale(t=1,e=1){let i=s.makeScale(t,e);this.multMatrix(i)}invert(){let t=new s;if(!1===s.invert(this.matrix,t))throw alert("堆栈顶部矩阵为奇异矩阵，无法求逆"),new Error("堆栈顶部矩阵为奇异矩阵，无法求逆");return t}};class n{constructor(){this._worldMatrixStack=[],this._worldMatrixStack.push((new i).setIdentity())}get worldMatrix(){if(this._worldMatrixStack.length<=0)throw new Error("model matrix stack为空");return this._worldMatrixStack[this._worldMatrixStack.length-1]}pushMatrix(){let t=new i;return this.worldMatrix.copy(t),this._worldMatrixStack.push(t),this}popMatrix(){return this._worldMatrixStack.pop(),this}loadIdentity(){return this.worldMatrix.setIdentity(),this}loadMatrix(t){return t.copy(this.worldMatrix),this}multMatrix(t){return this.worldMatrix.multiply(t),this}translate(t){return this.worldMatrix.translate(t),this}rotate(t,s,e=!1){return!1===e&&(t=u.toRadian(t)),this.worldMatrix.rotate(t,s),this}scale(t){return this.worldMatrix.scale(t),this}}const o=new i;var v,c,x,_;!function(t){t[t.FPSCAREMA=0]="FPSCAREMA",t[t.FLYCAMERA=1]="FLYCAMERA"}(v||(v={}));class E{constructor(t,s,e,r=45,a=1,h=1e3){this._type=v.FLYCAMERA,this._position=new l,this._xAxis=new l([1,0,0]),this._yAxis=new l([0,1,0]),this._zAxis=new l([0,0,1]),this.gl=t,this._aspectRatio=s/e,this._fovY=r,this._near=a,this._far=h,this._projectionMatirx=new i,this._viewMatrix=new i,this._viewProjnMatrix=new i,this._invViewProjMatrix=new i}get fovY(){return this._fovY}set fovY(t){this._fovY=t}get near(){return this._near}set near(t){this._near=t}get far(){return this._far}set far(t){this._far=t}get aspect(){return this._aspectRatio}set aspect(t){this._aspectRatio=t}get position(){return this._position}set position(t){this._position=t}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get z(){return this._position.z}set z(t){this._position.z=t}get xAxis(){return this._xAxis}get yAxis(){return this._yAxis}get zAxis(){return this._zAxis}get type(){return this._type}set type(t){this._type=t}get viewMatrix(){return this._viewMatrix}get projMatrix(){return this._projectionMatirx}get viewProjMatrix(){return this._viewProjnMatrix}get invViewProjMatrix(){return this._invViewProjMatrix}moveForward(t){this._type===v.FPSCAREMA?(this._position.x+=this._zAxis.x*t,this._position.y+=this._zAxis.z*t):(this._position.x+=this._zAxis.x*t,this._position.y+=this._zAxis.y*t,this._position.z+=this._zAxis.z*t)}moveRightward(t){this._type===v.FPSCAREMA?(this._position.x+=this._xAxis.x*t,this._position.y+=this._xAxis.z*t):(this._position.x+=this._xAxis.x*t,this._position.y+=this._xAxis.y*t,this._position.z+=this._xAxis.z*t)}moveUpward(t){this._type===v.FPSCAREMA?this._position.y+=t:(this._position.x+=this._yAxis.x*t,this._position.y+=this._yAxis.y*t,this._position.z+=this._yAxis.z*t)}yaw(t){o.setIdentity(),t=u.toRadian(t),this._type===v.FPSCAREMA?o.rotate(t,l.up):o.rotate(t,this._yAxis),o.multiplyVec3(this._zAxis,this._zAxis),o.multiplyVec3(this._xAxis,this._xAxis)}pitch(t){o.setIdentity(),t=u.toRadian(t),o.rotate(t,this._xAxis),o.multiplyVec3(this._zAxis,this._zAxis),o.multiplyVec3(this._yAxis,this._yAxis)}roll(t){this._type===v.FLYCAMERA&&(t=u.toRadian(t),o.setIdentity(),o.rotate(t,this._zAxis),o.multiplyVec3(this._xAxis,this._xAxis),o.multiplyVec3(this._yAxis,this._yAxis))}update(t){this._projectionMatirx=i.perspective(this._fovY,this._aspectRatio,this._near,this._far),this._calcViewMatrix(),i.product(this._projectionMatirx,this._viewMatrix,this._viewProjnMatrix),this._viewProjnMatrix.copy(this._invViewProjMatrix),this._invViewProjMatrix.inverse()}_calcViewMatrix(){this._zAxis.normalize(),l.cross(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize(),l.cross(this._yAxis,this._zAxis,this._xAxis),this._xAxis.normalize();let t=-l.dot(this._xAxis,this._position),s=-l.dot(this._yAxis,this._position),e=-l.dot(this._zAxis,this._position);this._viewMatrix.Values[0]=this._xAxis.x,this._viewMatrix.Values[1]=this._yAxis.x,this._viewMatrix.Values[2]=this._zAxis.x,this._viewMatrix.Values[3]=0,this._viewMatrix.Values[4]=this._xAxis.y,this._viewMatrix.Values[5]=this._yAxis.y,this._viewMatrix.Values[6]=this._zAxis.y,this._viewMatrix.Values[7]=0,this._viewMatrix.Values[8]=this._xAxis.z,this._viewMatrix.Values[9]=this._yAxis.z,this._viewMatrix.Values[10]=this._zAxis.z,this._viewMatrix.Values[11]=0,this._viewMatrix.Values[12]=t,this._viewMatrix.Values[13]=s,this._viewMatrix.Values[14]=e,this._viewMatrix.Values[15]=1}lookAt(t,s=l.up){this._viewMatrix=i.lookAt(this._position,t,s),this._xAxis.x=this._viewMatrix.Values[0],this._yAxis.x=this._viewMatrix.Values[1],this._zAxis.x=this._viewMatrix.Values[2],this._xAxis.y=this._viewMatrix.Values[4],this._yAxis.y=this._viewMatrix.Values[5],this._zAxis.y=this._viewMatrix.Values[6],this._xAxis.z=this._viewMatrix.Values[8],this._yAxis.z=this._viewMatrix.Values[9],this._zAxis.z=this._viewMatrix.Values[10]}setViewport(t,s,e,i){this.gl.viewport(t,s,e,i)}getViewport(){return this.gl.getParameter(this.gl.VIEWPORT)}}!function(t){t[t.MOUSEEVENT=0]="MOUSEEVENT",t[t.MOUSEDOWN=1]="MOUSEDOWN",t[t.MOUSEUP=2]="MOUSEUP",t[t.MOUSEMOVE=3]="MOUSEMOVE",t[t.MOUSEDRAG=4]="MOUSEDRAG",t[t.KEYBOARDEVENT=5]="KEYBOARDEVENT",t[t.KEYUP=6]="KEYUP",t[t.KEYDOWN=7]="KEYDOWN",t[t.KEYPRESS=8]="KEYPRESS"}(c||(c={}));class d{constructor(t=!1,s=!1,e=!1,i=c.MOUSEEVENT){this.altKey=t,this.ctrlKey=s,this.shiftKey=e,this.type=i}}class A extends d{constructor(t,s,e,i=!1,r=!1,a=!1){super(i,r,a,c.KEYBOARDEVENT),this.key=t,this.keyCode=s,this.repeat=e}}class y extends d{constructor(s,e,i=!1,r=!1,a=!1){super(i,r,a),this.canvasPosition=s,this.button=e,this.localPosition=t.create(),this.hasLocalPosition=!1}}class g{constructor(t){this.id=-1,this.enabled=!1,this.callbackData=void 0,this.countdown=0,this.timeout=0,this.onlyOnce=!1,this.callback=t}}class O{static makeVertexAttribs(t,s,e,i,r){let a=O.POSITION_BIT;return t&&(a|=O.TEXCOORD_BIT),s&&(a|=O.TEXCOORD1_BIT),e&&(a|=O.NORMAL_BIT),i&&(a|=O.TANGENT_BIT),r&&(a|=O.COLOR_BIT),a}static hasPostion(t){return 0!=(t&O.POSITION_BIT)}static hasNormal(t){return 0!=(t&O.NORMAL_BIT)}static hasTangent(t){return 0!=(t&O.TANGENT_BIT)}static hasColor(t){return 0!=(t&O.COLOR_BIT)}static hasTexcoord(t){return 0!=(t&O.TEXCOORD_BIT)}static hasTexcoord1(t){return 0!=(t&O.TEXCOORD1_BIT)}static getInterleavedLayoutAttribOffsetMap(t){let s={},e=0;return O.hasPostion(t)&&(s[O.POSITION_NAME]=0,e+=O.POSITION_COMPONENT*O.FLOAT32_SIZE),O.hasNormal(t)&&(s[O.NORMAL_NAME]=e,e+=O.NORMAL_COMPONENT*O.FLOAT32_SIZE),O.hasTexcoord(t)&&(s[O.TEXCOORD_NAME]=e,e+=O.TEXCOORD_COMPONENT*O.FLOAT32_SIZE),O.hasTexcoord1(t)&&(s[O.TEXCOORD1_NAME]=e,e+=O.TEXCOORD1_COMPONENT*O.FLOAT32_SIZE),O.hasColor(t)&&(s[O.COLOR_NAME]=e,e+=O.COLOR_COMPONENT*O.FLOAT32_SIZE),O.hasTangent(t)&&(s[O.TANGENT_NAME]=e,e+=O.TANGENT_COMPONENT*O.FLOAT32_SIZE),s[O.ATTRIBSTRIDE]=e,s[O.ATTRIBBYTELENGTH]=e,s}static getSequencedLayoutAttribOffsetMap(t,s){let e={},i=0;return O.hasPostion(t)&&(e[O.POSITION_NAME]=0,i+=s*O.POSITION_COMPONENT*O.FLOAT32_SIZE),O.hasNormal(t)&&(e[O.NORMAL_NAME]=i,i+=s*O.NORMAL_COMPONENT*O.FLOAT32_SIZE),O.hasTexcoord(t)&&(e[O.TEXCOORD_NAME]=i,i+=s*O.TEXCOORD_COMPONENT*O.FLOAT32_SIZE),O.hasTexcoord1(t)&&(e[O.TEXCOORD1_NAME]=i,i+=s*O.TEXCOORD1_COMPONENT*O.FLOAT32_SIZE),O.hasColor(t)&&(e[O.COLOR_NAME]=i,i+=s*O.COLOR_COMPONENT*O.FLOAT32_SIZE),O.hasTangent(t)&&(e[O.TANGENT_NAME]=i,i+=s*O.TANGENT_COMPONENT*O.FLOAT32_SIZE),e[O.ATTRIBSTRIDE]=i/s,e[O.ATTRIBBYTELENGTH]=i,e}static getSepratedLayoutAttribOffsetMap(t){let s={};return O.hasPostion(t)&&(s[O.POSITION_NAME]=0),O.hasNormal(t)&&(s[O.NORMAL_NAME]=0),O.hasTexcoord(t)&&(s[O.TEXCOORD_NAME]=0),O.hasTexcoord1(t)&&(s[O.TEXCOORD1_NAME]=0),O.hasColor(t)&&(s[O.COLOR_NAME]=0),O.hasTangent(t)&&(s[O.TANGENT_NAME]=0),s}static getVertexByteStride(t){let s=0;return O.hasPostion(t)&&(s+=O.POSITION_COMPONENT*O.FLOAT32_SIZE),O.hasNormal(t)&&(s+=O.NORMAL_COMPONENT*O.FLOAT32_SIZE),O.hasTexcoord(t)&&(s+=O.TEXCOORD_COMPONENT*O.FLOAT32_SIZE),O.hasTexcoord1(t)&&(s+=O.TEXCOORD1_COMPONENT*O.FLOAT32_SIZE),O.hasColor(t)&&(s+=O.COLOR_COMPONENT*O.FLOAT32_SIZE),O.hasTangent(t)&&(s+=O.TANGENT_COMPONENT*O.FLOAT32_SIZE),s}static setAttribVertexArrayPointer(t,s){let e=s[O.ATTRIBSTRIDE];if(0===e)throw new Error("vertex Array有问题");void 0!==e&&e===s[O.ATTRIBBYTELENGTH]||(e=0);let i=s[O.POSITION_NAME];void 0!==i&&t.vertexAttribPointer(O.POSITION_LOCATION,O.POSITION_COMPONENT,t.FLOAT,!1,e,i),i=s[O.NORMAL_NAME],void 0!==i&&t.vertexAttribPointer(O.NORMAL_LOCATION,O.NORMAL_COMPONENT,t.FLOAT,!1,e,i),i=s[O.TEXCOORD_NAME],void 0!==i&&t.vertexAttribPointer(O.TEXCOORD_LOCATION,O.TEXCOORD_COMPONENT,t.FLOAT,!1,e,i),i=s[O.TEXCOORD1_NAME],void 0!==i&&t.vertexAttribPointer(O.TEXCOORD1_LOCATION,O.TEXCOORD1_COMPONENT,t.FLOAT,!1,e,i),i=s[O.COLOR_NAME],void 0!==i&&t.vertexAttribPointer(O.COLOR_LOCATION,O.COLOR_COMPONENT,t.FLOAT,!1,e,i),i=s[O.TANGENT_NAME],void 0!==i&&t.vertexAttribPointer(O.TANGENT_LOCATION,O.TANGENT_COMPONENT,t.FLOAT,!1,e,i)}static setAttribVertexArrayState(t,s,e=!0){O.hasPostion(s)&&(e?t.enableVertexAttribArray(O.POSITION_LOCATION):t.disableVertexAttribArray(O.POSITION_LOCATION)),O.hasNormal(s)&&(e?t.enableVertexAttribArray(O.NORMAL_LOCATION):t.disableVertexAttribArray(O.NORMAL_LOCATION)),O.hasTexcoord(s)&&(e?t.enableVertexAttribArray(O.TEXCOORD_LOCATION):t.disableVertexAttribArray(O.TEXCOORD_LOCATION)),O.hasTexcoord1(s)&&(e?t.enableVertexAttribArray(O.TEXCOORD1_LOCATION):t.disableVertexAttribArray(O.TEXCOORD1_LOCATION)),O.hasColor(s)&&(e?t.enableVertexAttribArray(O.COLOR_LOCATION):t.disableVertexAttribArray(O.COLOR_LOCATION)),O.hasTangent(s)&&(e?t.enableVertexAttribArray(O.TANGENT_LOCATION):t.disableVertexAttribArray(O.TANGENT_LOCATION))}}O.POSITION_BIT=1,O.POSITION_COMPONENT=3,O.POSITION_NAME="aPosition",O.POSITION_LOCATION=0,O.TEXCOORD_BIT=2,O.TEXCOORD_COMPONENT=2,O.TEXCOORD_NAME="aTexCoord",O.TEXCOORD_LOCATION=1,O.TEXCOORD1_BIT=4,O.TEXCOORD1_COMPONENT=2,O.TEXCOORD1_NAME="aTexCoord1",O.TEXCOORD1_LOCATION=2,O.NORMAL_BIT=8,O.NORMAL_COMPONENT=3,O.NORMAL_NAME="aNormal",O.NORMAL_LOCATION=3,O.TANGENT_BIT=16,O.TANGENT_COMPONENT=4,O.TANGENT_NAME="aTangent",O.TANGENT_LOCATION=4,O.COLOR_BIT=32,O.COLOR_COMPONENT=4,O.COLOR_NAME="aColor",O.COLOR_LOCATION=5,O.ATTRIBSTRIDE="STRIDE",O.ATTRIBBYTELENGTH="BYTELENGTH",O.FLOAT32_SIZE=Float32Array.BYTES_PER_ELEMENT,O.UINT16_SIZE=Uint16Array.BYTES_PER_ELEMENT;class T{constructor(t,s,e){this.size=t,this.type=s,this.location=e}}class w{constructor(t,s,e){this.size=t,this.type=s,this.location=e}}!function(t){t[t.VS_SHADER=0]="VS_SHADER",t[t.FS_SAHDER=1]="FS_SAHDER"}(x||(x={})),function(t){t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35677]="SAMPLER_2D",t[t.SAMPLER_CUBE=35678]="SAMPLER_CUBE",t[t.FLOAT=5126]="FLOAT",t[t.INT=5124]="INT"}(_||(_={}));class M{static printStates(t){null!==t&&console.log(`\n        isBlendEnable = ${t.isEnabled(t.BLEND)}\n        isCullFaceEnable = ${t.isEnabled(t.CULL_FACE)}\n        isDepthTestEnable = ${t.isEnabled(t.DEPTH_TEST)}\n        isDitherEnable = ${t.isEnabled(t.DITHER)}\n        isPolygonOffsetFillEnable = ${t.isEnabled(t.POLYGON_OFFSET_FILL)}\n        isSampleAlphaToCoverageEnable = ${t.isEnabled(t.SAMPLE_ALPHA_TO_COVERAGE)} \n        isSampleCoverageEnable = ${t.isEnabled(t.SAMPLE_COVERAGE)}\n        isScissorTestEnable = ${t.isEnabled(t.SCISSOR_TEST)}\n        isStencilTestEnable = ${t.isEnabled(t.STENCIL_TEST)}\n        `)}static triggerContextLostEvent(t){let s=t.getExtension("WEBGL_lose_context");null!==s&&s.loseContext()}static printWebGLInfo(t){console.log(`\n        renderer = ${t.getParameter(t.RENDERER)}\n        version = ${t.getParameter(t.VERSION)}\n        vendor = ${t.getParameter(t.VENDOR)}\n        glsl version = ${t.getParameter(t.SHADING_LANGUAGE_VERSION)}\n        `)}static checkGLError(t){switch(t.getError()){case t.INVALID_ENUM:throw new Error("An unacceptable value has been specified for an enumerated argument. The command is ignored and the error flag is set");case t.INVALID_OPERATION:throw new Error("The specified command is not allowed for the current state. The command is ignored and the error flag is set.");case t.INVALID_VALUE:throw new Error("A numeric argument is out of range. The command is ignored and the error flag is set.");case t.INVALID_FRAMEBUFFER_OPERATION:throw new Error("use invalid framebuffer operation");case t.OUT_OF_MEMORY:throw new Error("Not enough memory is left to execute the command.");case t.CONTEXT_LOST_WEBGL:throw new Error("If the WebGL context is lost, this error is returned on the first call to getError. Afterwards and until the context has been restored, it returns gl.NO_ERROR.")}}static createShader(t,s){let e=null;if(e=s===x.VS_SHADER?t.createShader(t.VERTEX_SHADER):t.createShader(t.FRAGMENT_SHADER),null===e)throw new Error("shader创建失败");return e}static compileShader(t,s,e){return t.shaderSource(e,s),t.compileShader(e),!1!==t.getShaderParameter(e,t.COMPILE_STATUS)||(console.log(t.getShaderInfoLog(e)),t.deleteShader(e),!1)}static createProgram(t){let s=t.createProgram();if(null===s)throw new Error("WebGLProgram创建失败");return s}static linkProgram(t,s,e,i,r=null,a=null){return t.attachShader(s,e),t.attachShader(s,i),null!==r&&r(t,s),t.linkProgram(s),!1===t.getProgramParameter(s,t.LINK_STATUS)?(console.log(t.getProgramInfoLog(s)),t.detachShader(s,e),t.detachShader(s,i),t.deleteShader(e),t.deleteShader(i),t.deleteProgram(s),!1):(null!==a&&a(t,s),!0)}static getProgramActiveAttribs(t,s,e){let i=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){let i=t.getActiveAttrib(s,r);i&&(e[i.name]=new T(i.size,i.type,t.getAttribLocation(s,i.name)))}}static getProgramActiveUniforms(t,s,e){let i=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){let i=t.getActiveUniform(s,r);if(i){let r=t.getUniformLocation(s,i.name);r&&(e[i.name]=new w(i.size,i.type,r))}}}static createBuffer(t){let s=t.createBuffer();if(null===s)throw new Error("WebGLBuffer创建失败");return s}}const m={vs:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        attribute vec4 aColor;\n        uniform mat4 uMVPMatrix;\n        varying vec4 vColor;\n        void main(){\n            gl_Position = uMVPMatrix*vec4(aPosition,1.0);\n            vColor = aColor;\n        }\n        ",fs:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        varying vec4 vColor;\n        void main(){\n            gl_FragColor = vColor;\n        }\n        "},N={vs:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 uMVPMatrix;\n        varying vec2 vTexCoord;\n        void main(){\n            gl_Position = uMVPMatrix*vec4(aPosition,1.0);\n            vTexCoord = aTexCoord;\n        }\n        ",fs:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        uniform sampler2D uSampler;\n        varying vec2 vTexCoord;\n        void main(){\n            gl_FragColor =  texture2D(uSampler,vTexCoord);\n        }\n        "};class p{constructor(t,s,e=null,i=null,r=""){this.gl=t,this._attribState=s,this.bindCallback=null,this.unbindCallback=null;let a=this.gl,h=M.createShader(a,x.VS_SHADER);if(null===h)throw new Error("Create Vertex Shader Fail");if(this.vsShader=h,h=M.createShader(a,x.FS_SAHDER),null===h)throw new Error("Create Fragment Shader Fail");this.fsShader=h;let l=M.createProgram(a);if(null===l)throw new Error("Create Program Fail");this.program=l,this.attribMap={},this.uniformMap={},null!==e&&null!==i&&this.loadShaders(e,i),this.name=r}static createDefaultTextureProgram(t){return new p(t,O.makeVertexAttribs(!0,!1,!1,!1,!1),N.vs,N.fs)}static createDefaultColorPorgram(t){return new p(t,O.makeVertexAttribs(!1,!1,!1,!1,!0),m.vs,m.fs)}programBeforeLink(t,s){O.hasPostion(this._attribState)&&t.bindAttribLocation(s,O.POSITION_LOCATION,O.POSITION_NAME),O.hasNormal(this._attribState)&&t.bindAttribLocation(s,O.NORMAL_LOCATION,O.NORMAL_NAME),O.hasTexcoord(this._attribState)&&t.bindAttribLocation(s,O.TEXCOORD_LOCATION,O.TEXCOORD_NAME),O.hasTexcoord1(this._attribState)&&t.bindAttribLocation(s,O.TEXCOORD1_LOCATION,O.TEXCOORD1_NAME),O.hasColor(this._attribState)&&t.bindAttribLocation(s,O.COLOR_LOCATION,O.COLOR_NAME),O.hasTangent(this._attribState)&&t.bindAttribLocation(s,O.TANGENT_LOCATION,O.TANGENT_NAME)}programAfterLink(t,s){M.getProgramActiveAttribs(t,s,this.attribMap),M.getProgramActiveUniforms(t,s,this.uniformMap),console.log(JSON.stringify(this.attribMap)),console.log(JSON.stringify(this.uniformMap))}loadShaders(t,s){if(!1===M.compileShader(this.gl,t,this.vsShader))throw new Error("WEBGL Vertex Shader Compile Fail");if(!1===M.compileShader(this.gl,s,this.fsShader))throw new Error("WEBGL Fragment Shader Compile Fail");if(!1===M.linkProgram(this.gl,this.program,this.vsShader,this.fsShader,this.programBeforeLink.bind(this),this.programAfterLink.bind(this)))throw console.log(this.gl.getProgramInfoLog(this.program)),new Error("WEBGLProgram Link Fail")}bind(){this.gl.useProgram(this.program),null!==this.bindCallback&&this.bindCallback(this)}unbind(){null!==this.unbindCallback&&this.unbindCallback(this),this.gl.useProgram(null)}getUniformLocation(t){return this.gl.getUniformLocation(this.program,t)}setMatrix4(t,s){let e=this.getUniformLocation(t);return!!e&&(this.gl.uniformMatrix4fv(e,!1,s.Values),!0)}setTexture(t,s){let e=this.getUniformLocation(t);return!!e&&(this.gl.uniform1i(e,s),!0)}}p.MVMatrix="uMVMatrix",p.ModelMatrix="uModelMatrix",p.ViewMatrix="uViewMatrix",p.ProjectMatrix="uProjectMatrix",p.NormalMatrix="uNormalMatrix",p.MVPMatrix="uMVPMatrix",p.Color="uColor",p.Sampler="uSampler",p.DiffuseSamler="uDiffuseSampler",p.NormalSampler="uNormalSampler",p.SpecularSampelr="uSpecularSampler",p.DepthSampler="uDepthSampelr";class f{constructor(t=!0){this._count=0,this._items=t?new Map:{}}get length(){return this._count}get keys(){let t=[];if(this._items instanceof Map){let s=this._items.keys();for(let e of s)t.push(e)}else for(let s in this._items)t.push(s);return t}get values(){let t=[];if(this._items instanceof Map){let s=this._items.values();for(let e of s)t.push(e)}else for(let s in this._items)t.push(this._items[s]);return t}contains(t){return this._items instanceof Map?this._items.has(t):void 0!==this._items[t]}find(t){return this._items instanceof Map?this._items.get(t):this._items[t]}insert(t,s){this._items instanceof Map?this._items.set(t,s):this._items[t]=s,this._count++}remove(t){return void 0!==this.find(t)&&(this._items instanceof Map?this._items.delete(t):delete this._items[t],this._count--,!0)}toString(){return JSON.stringify(this._items)}}class R{constructor(){this._dict=new f,console.log("create new GLProgramCacher")}set(t,s){this._dict.insert(t,s)}getMaybe(t){return this._dict.find(t)}getMust(t){let s=this._dict.find(t);if(void 0===s)throw new Error(t+"对应的Program不存在");return s}remove(t){return this._dict.remove(t)}}var b,C;R.instance=new R,function(t){t[t.GL_CLAMP_TO_EDGE=0]="GL_CLAMP_TO_EDGE",t[t.GL_REPEAT=1]="GL_REPEAT",t[t.GL_MIRRORED_REPEAT=2]="GL_MIRRORED_REPEAT"}(b||(b={}));class S{constructor(t,s=""){this.gl=t,this.isMipmap=!1,this.width=this.height=0,this.format=t.RGBA,this.type=t.UNSIGNED_BYTE;let e=t.createTexture();if(null===e)throw new Error("webgltexture create fail");this.texture=e,this.target=t.TEXTURE_2D,this.name=s}static isPowerOfTwo(t){return 0==(t-1&t)}static getNextPowerofTwo(t){if(t<=0)throw new Error("必须大于0");--t;for(var s=1;s<32;s<<=1)t|=t>>s;return t+1}static createPowerOfTwoCanvas(t){let s=document.createElement("canvas");s.width=S.getNextPowerofTwo(t.width),s.height=S.getNextPowerofTwo(t.height);let e=s.getContext("2d");if(null===e)throw new Error("create canvasrenderingcontext2d fail");return e.drawImage(t,0,0,t.width,t.height,0,0,s.width,s.height),s}static createDefaultTexture(t){let s=document.createElement("canvas");s.width=128,s.height=128;let e=s.getContext("2d");if(null===e)throw new Error("create canvasrenderingcontext2d fail");for(let t=0;t<4;t++)for(let s=0;s<4;s++){let i=4*t+s;e.save(),e.fillStyle=u.Colors[i],e.fillRect(32*t,32*s,32,32),e.restore()}let i=new S(t);return i.wrap(),i.filter(),i.upload(s),i}upload(t,s=0,e=!1){if(this.bind(s),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,1),this.width=t.width,this.height=t.height,!0===e){let s=S.isPowerOfTwo(this.width),e=S.isPowerOfTwo(this.height);if(s&&e)this.gl.texImage2D(this.target,0,this.format,this.format,this.type,t),this.gl.generateMipmap(this.target);else{let s=S.createPowerOfTwoCanvas(t);this.gl.texImage2D(this.target,0,this.format,this.format,this.type,s),M.checkGLError(this.gl),this.gl.generateMipmap(this.target),M.checkGLError(this.gl),this.width=s.width,this.height=s.height}this.isMipmap=!0}else this.isMipmap=!1,this.gl.texImage2D(this.target,0,this.format,this.format,this.type,t);this.unbind()}wrap(t=b.GL_REPEAT){this.gl.bindTexture(this.target,this.texture),t===b.GL_CLAMP_TO_EDGE?(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE)):t===b.GL_REPEAT?(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)):(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.MIRRORED_REPEAT),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.MIRRORED_REPEAT))}filter(t=!0,s=!0){this.gl.bindTexture(this.target,this.texture),this.isMipmap?this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,t?this.gl.LINEAR_MIPMAP_LINEAR:this.gl.NEAREST_MIPMAP_NEAREST):this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,t?this.gl.LINEAR:this.gl.NEAREST),this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,s?this.gl.LINEAR:this.gl.NEAREST)}bind(t){null!==this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.target,this.texture))}unbind(){null!==this.texture&&this.gl.bindTexture(this.target,null)}}class L{constructor(){this._dict=new f,console.log("create texture cache")}set(t,s){this._dict.insert(t,s)}getMaybe(t){return this._dict.find(t)}getMust(t){let s=this._dict.find(t);if(void 0===s)throw new Error(t+"对应的Program不存在");return s}remove(t){return this._dict.remove(t)}}L.instance=new L;class I{constructor(t,s=8){this.capacityChangedCallback=null,this._typedArrayContructor=t,this._capacity=s,0===this._capacity&&(this._capacity=8),this._arr=new this._typedArrayContructor(this._capacity),this._length=0}get length(){return this._length}get capacity(){return this._capacity}get typeArray(){return this._arr}push(t){if(this._length>=this._capacity){this._capacity>0&&(this._capacity+=this._capacity,null!==this.capacityChangedCallback&&this.capacityChangedCallback(this));let t=this._arr;this._arr=new this._typedArrayContructor(this._capacity),this._arr.set(t)}return this._arr[this._length++]=t,this._length}pushArray(t){for(let s=0;s<t.length;s++)this.push(t[s]);return this._length}subArray(t=0,s=this._length){return this._arr.subarray(t,s)}slice(t=0,s=this._length){return this._arr.slice(t,s)}clear(){this._length=0}at(t){if(t<0||t>=this.length)throw new Error("索引越界");return this._arr[t]}}!function(t){t[t.INTERLEAVED=0]="INTERLEAVED",t[t.SEQUENCED=1]="SEQUENCED",t[t.SEPARATED=2]="SEPARATED"}(C||(C={}));class P extends class{constructor(t,s,e=t.TRIANGLES){this.gl=t;let i=this.gl.getExtension("OES_vertex_array_object");if(null===i)throw new Error("Not Support OES_vertex_array_object");this._vao=i;let r=this._vao.createVertexArrayOES();if(null===r)throw new Error("Not Support WebGLVertexArrayObjectOES");this._vaoTarget=r,this._attribState=s,this._attribStride=O.getVertexByteStride(this._attribState),this.drawMode=e}get vertexStride(){return this._attribStride}bind(){this._vao.bindVertexArrayOES(this._vaoTarget)}unbind(){this._vao.bindVertexArrayOES(null)}}{constructor(t,s,i,a=null,h=C.INTERLEAVED){super(t,s),this._color=new e([0,0,0,0]),this._texCoord=new r([0,0]),this._normal=new l([0,0,1]),this._lists={},this._buffers={},this._vertCount=0,this._hasColor=O.hasColor(s),this._hasNormal=O.hasNormal(s),this._hasTexcoord=O.hasTexcoord(s),this._layout=h,this.program=i,this.texture=a,this.bind();let u=this.gl.createBuffer();if(null===u)throw new Error("WebGLBuffer Create Fail");if(this._layout===C.INTERLEAVED){this._lists[P.INTERLEAVED]=new I(Float32Array),this._buffers[P.INTERLEAVED]=u,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,u);let t=O.getInterleavedLayoutAttribOffsetMap(this._attribState);O.setAttribVertexArrayState(this.gl,this._attribState),O.setAttribVertexArrayPointer(this.gl,t)}else if(this._layout===C.SEQUENCED)this._lists[O.POSITION_NAME]=new I(Float32Array),this._hasColor&&(this._lists[O.COLOR_NAME]=new I(Float32Array)),this._hasTexcoord&&(this._lists[O.TEXCOORD_NAME]=new I(Float32Array)),this._hasNormal&&(this._lists[O.NORMAL_NAME]=new I(Float32Array)),this._buffers[P.SEQUENCED]=u,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,u),O.setAttribVertexArrayState(this.gl,this._attribState);else{if(this._lists[O.POSITION_NAME]=new I(Float32Array),this._buffers[O.POSITION_NAME]=u,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,u),this._hasColor){if(this._lists[O.COLOR_NAME]=new I(Float32Array),u=this.gl.createBuffer(),null===u)throw new Error("WebGLBuffer create fail");this._buffers[O.COLOR_NAME]=u,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,u)}if(this._hasTexcoord){if(this._lists[O.TEXCOORD_NAME]=new I(Float32Array),u=this.gl.createBuffer(),null===u)throw new Error("WebGLBuffer create fail");this._buffers[O.TEXCOORD_NAME]=u,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,u)}if(this._hasNormal){if(this._lists[O.NORMAL_NAME]=new I(Float32Array),u=this.gl.createBuffer(),null===u)throw new Error("WebGLBuffer create fail");this._buffers[O.NORMAL_NAME]=u,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,u)}O.getSepratedLayoutAttribOffsetMap(this._attribState)}this.unbind()}color(t,s,e,i=1){return this._hasColor&&(this._color.r=t,this._color.g=s,this._color.b=e,this._color.a=i),this}normal(t,s,e){return this._hasNormal&&(this._normal.x=t,this._normal.y=s,this._normal.z=e),this}texcoord(t,s){return this._hasTexcoord&&(this._texCoord.x=t,this._texCoord.y=s),this}vertex(t,s,e){if(this._layout===C.INTERLEAVED){let i=this._lists[P.INTERLEAVED];i.pushArray([t,s,e]),this._hasTexcoord&&i.pushArray(this._texCoord.xy),this._hasNormal&&i.pushArray(this._normal.xyz),this._hasColor&&i.pushArray(this._color.rgba)}else{let i=this._lists[O.POSITION_NAME];i.pushArray([t,s,e]),this._hasTexcoord&&(i=this._lists[O.TEXCOORD_NAME],i.pushArray(this._texCoord.xy)),this._hasNormal&&(i=this._lists[O.NORMAL_NAME],i.pushArray(this._normal.xyz)),this._hasColor&&(i=this._lists[O.COLOR_NAME],i.pushArray(this._color.rgba))}return this._vertCount++,this}begin(t=this.gl.TRIANGLES){if(this.drawMode=t,this._vertCount=0,this._layout===C.INTERLEAVED)this._lists[P.INTERLEAVED].clear();else{let t=this._lists[O.POSITION_NAME];t.clear(),this._hasTexcoord&&(t=this._lists[O.TEXCOORD_NAME],t.clear()),this._hasNormal&&(t=this._lists[O.NORMAL_NAME],t.clear()),this._hasColor&&(t=this._lists[O.COLOR_NAME],t.clear())}return this}end(t){if(this.program.bind(),this.program.setMatrix4(p.MVPMatrix,t),this.texture&&(this.texture.bind(0),this.program.setTexture(p.Sampler,0)),this.bind(),this._layout===C.INTERLEAVED){let t=this._lists[P.INTERLEAVED],s=this._buffers[P.INTERLEAVED];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.subArray(),this.gl.DYNAMIC_DRAW)}else if(this._layout===C.SEQUENCED){let t=this._buffers[P.SEQUENCED];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,this._attribStride*this._vertCount,this.gl.DYNAMIC_DRAW);let s=O.getSequencedLayoutAttribOffsetMap(this._attribState,this._vertCount),e=this._lists[O.POSITION_NAME];this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,e.subArray()),this._hasTexcoord&&(e=this._lists[O.TEXCOORD_NAME],this.gl.bufferSubData(this.gl.ARRAY_BUFFER,s[O.TEXCOORD_NAME],e.subArray())),this._hasNormal&&(e=this._lists[O.NORMAL_NAME],this.gl.bufferSubData(this.gl.ARRAY_BUFFER,s[O.NORMAL_NAME],e.subArray())),this._hasColor&&(e=this._lists[O.COLOR_NAME],this.gl.bufferSubData(this.gl.ARRAY_BUFFER,s[O.COLOR_NAME],e.subArray())),O.setAttribVertexArrayPointer(this.gl,s)}else{let t=this._buffers[O.POSITION_NAME],s=this._lists[O.POSITION_NAME];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,s.subArray(),this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(O.POSITION_LOCATION),this.gl.vertexAttribPointer(O.POSITION_LOCATION,O.POSITION_COMPONENT,this.gl.FLOAT,!1,0,0),this._hasTexcoord&&(t=this._buffers[O.TEXCOORD_NAME],s=this._lists[O.TEXCOORD_NAME],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,s.subArray(),this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(O.TEXCOORD_LOCATION),this.gl.vertexAttribPointer(O.TEXCOORD_LOCATION,O.TEXCOORD_COMPONENT,this.gl.FLOAT,!1,0,0)),this._hasNormal&&(t=this._buffers[O.NORMAL_NAME],s=this._lists[O.NORMAL_NAME],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,s.subArray(),this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(O.NORMAL_LOCATION),this.gl.vertexAttribPointer(O.NORMAL_LOCATION,O.NORMAL_COMPONENT,this.gl.FLOAT,!1,0,0)),this._hasColor&&(t=this._buffers[O.COLOR_NAME],s=this._lists[O.COLOR_NAME],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,s.subArray(),this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(O.COLOR_LOCATION),this.gl.vertexAttribPointer(O.COLOR_LOCATION,O.COLOR_COMPONENT,this.gl.FLOAT,!1,0,0))}this.gl.drawArrays(this.drawMode,0,this._vertCount),this.unbind(),this.program.unbind()}}P.SEQUENCED="SEQUENCED",P.INTERLEAVED="INTERLEAVED";class z{static drawWireFrameCubeBox(t,s,i=.2,r=new e([1,0,0,1])){let a=new l([-i,-i,-i]),h=new l([i,i,i]);z.drawBoundBox(t,s,a,h,r)}static drawBoundBox(t,s,i,r,a=new e([1,0,0,1])){t.begin(t.gl.LINE_LOOP),t.color(a.r,a.g,a.b,a.a).vertex(i.x,i.y,i.z),t.color(a.r,a.g,a.b,a.a).vertex(i.x,i.y,r.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,i.y,r.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,i.y,i.z),t.end(s),t.begin(t.gl.LINE_LOOP),t.color(a.r,a.g,a.b,a.a).vertex(i.x,r.y,i.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,r.y,i.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,r.y,r.z),t.color(a.r,a.g,a.b,a.a).vertex(i.x,r.y,r.z),t.end(s),t.begin(t.gl.LINES),t.color(a.r,a.g,a.b,a.a).vertex(i.x,i.y,i.z),t.color(a.r,a.g,a.b,a.a).vertex(i.x,r.y,i.z),t.color(a.r,a.g,a.b,a.a).vertex(i.x,i.y,r.z),t.color(a.r,a.g,a.b,a.a).vertex(i.x,r.y,r.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,i.y,r.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,r.y,r.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,i.y,i.z),t.color(a.r,a.g,a.b,a.a).vertex(r.x,r.y,i.z),t.end(s)}static drawTextureCube(t,s,e=.2,i=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]){t.begin(t.gl.TRIANGLE_FAN),t.texcoord(i[0],i[1]).vertex(-e,-e,e),t.texcoord(i[2],i[3]).vertex(e,-e,e),t.texcoord(i[4],i[5]).vertex(e,e,e),t.texcoord(i[6],i[7]).vertex(-e,e,e),t.end(s),t.begin(t.gl.TRIANGLE_FAN),t.texcoord(i[8],i[9]).vertex(e,-e,e),t.texcoord(i[10],i[11]).vertex(e,-e,-e),t.texcoord(i[12],i[13]).vertex(e,e,-e),t.texcoord(i[14],i[15]).vertex(e,e,e),t.end(s),t.begin(t.gl.TRIANGLE_FAN),t.texcoord(i[16],i[17]).vertex(e,-e,-e),t.texcoord(i[18],i[19]).vertex(-e,-e,-e),t.texcoord(i[20],i[21]).vertex(-e,e,-e),t.texcoord(i[22],i[23]).vertex(e,e,-e),t.end(s),t.begin(t.gl.TRIANGLE_FAN),t.texcoord(i[24],i[25]).vertex(-e,-e,-e),t.texcoord(i[26],i[27]).vertex(-e,-e,e),t.texcoord(i[28],i[29]).vertex(-e,e,e),t.texcoord(i[30],i[31]).vertex(-e,e,-e),t.end(s),t.begin(t.gl.TRIANGLE_FAN),t.texcoord(i[32],i[33]).vertex(-e,e,e),t.texcoord(i[34],i[35]).vertex(e,e,e),t.texcoord(i[36],i[37]).vertex(e,e,-e),t.texcoord(i[38],i[39]).vertex(-e,e,-e),t.end(s),t.begin(t.gl.TRIANGLE_FAN),t.texcoord(i[40],i[41]).vertex(-e,-e,e),t.texcoord(i[42],i[43]).vertex(-e,-e,-e),t.texcoord(i[44],i[45]).vertex(e,-e,-e),t.texcoord(i[46],i[47]).vertex(e,-e,e),t.end(s)}}class D{constructor(t,s=l.zero,e=l.up,i=0,r=!1,a=!1){this.viewport=[],this.viewport=t,this.angle=i,this.axis=e,this.pos=s,this.isDrawAxis=r,this.isD3D=a}static makeViewportCoordSystems(t,s,e=2,i=2){let r=[],a=t/e,h=s/i;for(let t=0;t<e;t++)for(let s=0;s<i;s++)r.push(new D([t*a,s*h,a,h]));return r}}const V=new i;class F extends class extends class extends class{constructor(t){this._timeId=-1,this._fps=0,this._start=!1,this._requestId=-1,this.timers=[],this.canvas=t,this.canvas.addEventListener("mousedown",this,!1),this.canvas.addEventListener("mouseup",this,!1),this.canvas.addEventListener("mousemove",this,!1),window.addEventListener("keydown",this,!1),window.addEventListener("keyup",this,!1),window.addEventListener("keypress",this,!1),this._isMouseDonw=!1,this.isSupportMouseMove=!1}get fps(){return this._fps}_viewportToCanvasCoordinate(s){if(this.canvas){let e=this.canvas.getBoundingClientRect();if(s.target){let i=0,r=0,a=0,h=0,l=window.getComputedStyle(s.target),u=l.borderLeftWidth;null!==u&&(i=parseInt(u,10)),u=l.borderTopWidth,null!==u&&(r=parseInt(u,10)),u=l.paddingLeft,null!==u&&(a=parseInt(u,10)),u=l.paddingTop,null!==u&&(h=parseInt(u,10));let n=s.clientX-e.left-i-a,o=s.clientY-e.top-r-h;return t.create(n,o)}}throw alert("canvas未设置"),new Error("canvas未设置")}_toCanvasMouseEvent(t){let s=t,e=this._viewportToCanvasCoordinate(s);return new y(e,s.button,s.altKey,s.ctrlKey,s.shiftKey)}_toCanvasKeyBoardEvent(t){let s=t;return new A(s.key,s.keyCode,s.repeat,s.altKey,s.ctrlKey,s.shiftKey)}_handleTimers(t){for(let s=0;s<this.timers.length;s++){let e=this.timers[s];!1!==e.enabled&&(e.countdown-=t,e.countdown<0&&(e.callback(e.id,e.callbackData),!1===e.onlyOnce?e.countdown=e.timeout:this.removeTimer(e.id)))}}dispatchMouseDown(t){t.type=c.MOUSEDOWN}dispatchMouseUp(t){t.type=c.MOUSEUP}dispatchMouseMove(t){t.type=c.MOUSEMOVE}dispatchMouseDrag(t){t.type=c.MOUSEDRAG}dispatchKeyPress(t){t.type=c.KEYPRESS}dispatchKeyDown(t){t.type=c.KEYDOWN}dispatchKeyUp(t){t.type=c.KEYUP}addTimer(t,s=1,e=!1,i){let r;for(let a=0;a<this.timers.length;a++)if(r=this.timers[a],!1===r.enabled)return r.callback=t,r.callbackData=i,r.timeout=s,r.countdown=s,r.enabled=!0,r.onlyOnce=e,r.id;return r=new g(t),r.callbackData=i,r.timeout=s,r.countdown=s,r.enabled=!0,r.id=++this._timeId,r.onlyOnce=e,this.timers.push(r),r.id}removeTimer(t){let s=!1;for(let e=0;e<this.timers.length;e++)if(this.timers[e].id===t){this.timers[e].enabled=!1,s=!0;break}return s}handleEvent(t){switch(t.type){case"mousedown":this._isMouseDonw=!0,this.dispatchMouseDown(this._toCanvasMouseEvent(t));break;case"mouseup":this._isMouseDonw=!1,this.dispatchMouseUp(this._toCanvasMouseEvent(t));break;case"mousemove":this.isSupportMouseMove&&this.dispatchMouseMove(this._toCanvasMouseEvent(t)),this._isMouseDonw&&this.dispatchMouseDrag(this._toCanvasMouseEvent(t));break;case"keypress":this.dispatchKeyPress(this._toCanvasKeyBoardEvent(t));break;case"keydown":this.dispatchKeyDown(this._toCanvasKeyBoardEvent(t));break;case"keyup":this.dispatchKeyUp(this._toCanvasKeyBoardEvent(t))}}start(){this._start||(this._start=!0,this._requestId=-1,this._startTime=-1,this._lastTime=-1,this._requestId=requestAnimationFrame((t=>{this.step(t)})))}stop(){this._start&&(cancelAnimationFrame(this._requestId),this._requestId=-1,this._lastTime=-1,this._startTime=-1,this._start=!1)}isRunning(){return this._start}step(t){-1===this._startTime&&(this._startTime=t),-1===this._lastTime&&(this._lastTime=t);let s=t-this._startTime,e=t-this._lastTime;0!==e&&(this._fps=1e3/e),e/=1e3,this._lastTime=t,this._handleTimers(e),this.update(s,e),this.render(),this._requestId=requestAnimationFrame((t=>{this.step(t)}))}update(t,s){}render(){}}{constructor(t,s){super(t);let e=t.getContext("webgl",s);if(null===e)throw alert("无法创建WebGLRenderingContext上下文对象 "),new Error("无法创建WebGLRenderingContext上下文对象 ");this.gl=e,this._init()}_init(){this._initTextures(),this._intiShaders()}_initTextures(){L.instance.set("default",S.createDefaultTexture(this.gl))}_intiShaders(){R.instance.set("color",p.createDefaultColorPorgram(this.gl)),R.instance.set("texture",p.createDefaultTextureProgram(this.gl))}}{constructor(t,s){super(t,s),this.camera=new E(this.gl,this.canvas.width,this.canvas.height),this.camera.lookAt(new l([0,0,0])),this.matStack=new n}dispatchKeyPress(t){super.dispatchKeyPress(t),this.onKeyPress(t)}onKeyPress(t){"w"===t.key?this.camera.moveForward(-1):"a"===t.key?this.camera.moveRightward(-1):"s"===t.key?this.camera.moveForward(1):"d"===t.key?this.camera.moveRightward(1):"q"===t.key?this.camera.yaw(-1):"e"===t.key&&this.camera.yaw(1)}update(t,s){this.camera.update(s)}}{constructor(t){super(t),this.angle=0,this._cubeTexCoords=[0,.5,.5,.5,.5,1,0,1,.5,.5,1,.5,1,1,.5,1,0,0,.5,0,.5,.5,0,.5,.5,0,1,0,1,.5,.5,.5,.25,.25,.75,.25,.75,.75,.25,.75,0,0,1,0,1,1,0,1],this.texture=L.instance.getMust("default"),this.colorShader=R.instance.getMust("color"),this.texShader=R.instance.getMust("texture"),this.builder0=new P(this.gl,O.POSITION_BIT|O.COLOR_BIT,this.colorShader,null,C.INTERLEAVED),this.builder1=new P(this.gl,O.POSITION_BIT|O.COLOR_BIT,this.colorShader,null,C.SEQUENCED),this.builder2=new P(this.gl,O.POSITION_BIT|O.COLOR_BIT,this.colorShader,null,C.SEPARATED),this.tbuilder0=new P(this.gl,O.POSITION_BIT|O.TEXCOORD_BIT,this.texShader,this.texture,C.INTERLEAVED),this.tbuilder1=new P(this.gl,O.POSITION_BIT|O.TEXCOORD_BIT,this.texShader,this.texture,C.SEQUENCED),this.tbuilder2=new P(this.gl,O.POSITION_BIT|O.TEXCOORD_BIT,this.texShader,this.texture,C.SEPARATED),this.camera.z=8,this.coords=D.makeViewportCoordSystems(t.width,t.height,2,3),this.currentDrawMethod=this.drawByMultiViewportsWithTextureShader,F.setDefaultState(this.gl)}static setDefaultState(t){t.clearColor(0,0,0,0),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE)}setViewport(t){this.camera.setViewport(t.viewport[0],t.viewport[1],t.viewport[2],t.viewport[3])}drawByMatrixWithColorShader(){this.camera.setViewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(.8,.8,.8,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.disable(this.gl.CULL_FACE),this.matStack.pushMatrix(),this.matStack.translate(new l([-1.5,0,0])),this.matStack.rotate(this.angle,l.forward),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),this.builder0.begin(this.gl.TRIANGLES),this.builder0.color(1,0,0).vertex(-.5,0,0),this.builder0.color(0,1,0).vertex(.5,0,0),this.builder0.color(0,0,1).vertex(0,.5,0),this.builder0.end(V),this.matStack.popMatrix(),this.matStack.pushMatrix(),this.matStack.rotate(this.angle,l.up),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),this.builder1.begin(this.gl.TRIANGLE_FAN),this.builder1.color(1,0,0).vertex(-.5,0,0),this.builder1.color(0,1,0).vertex(.5,0,0),this.builder1.color(0,0,1).vertex(.5,.5,0),this.builder1.color(0,0,1).vertex(-.5,.5,0),this.builder1.end(V),this.matStack.popMatrix(),this.matStack.pushMatrix(),this.matStack.translate(new l([1.5,0,0])),this.matStack.rotate(-this.angle,new l([1,1,1]).normalize()),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),z.drawWireFrameCubeBox(this.builder2,V,.2),this.matStack.popMatrix(),this.gl.enable(this.gl.CULL_FACE)}drawByMultiViewportsWithTextureShader(){this.setViewport(this.coords[0]),this.gl.clearColor(1,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.matStack.pushMatrix(),this.matStack.rotate(this.angle,l.up),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),z.drawTextureCube(this.tbuilder0,V,.5,this._cubeTexCoords),this.matStack.popMatrix(),this.setViewport(this.coords[1]),this.matStack.pushMatrix(),this.matStack.rotate(this.angle,l.right),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),z.drawTextureCube(this.tbuilder1,V,.5,this._cubeTexCoords),this.matStack.popMatrix(),this.setViewport(this.coords[2]),this.matStack.pushMatrix(),this.matStack.rotate(this.angle,l.forward),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),z.drawTextureCube(this.tbuilder2,V,.5,this._cubeTexCoords),this.matStack.popMatrix(),this.setViewport(this.coords[3]),this.matStack.pushMatrix(),this.matStack.rotate(this.angle,new l([1,1,1]).normalize()),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),z.drawTextureCube(this.tbuilder0,V,.8,this._cubeTexCoords),this.matStack.popMatrix(),this.setViewport(this.coords[4]),this.matStack.pushMatrix(),this.matStack.rotate(-this.angle,l.right),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),z.drawTextureCube(this.tbuilder1,V,.5),this.matStack.popMatrix(),this.setViewport(this.coords[5]),this.matStack.pushMatrix(),this.matStack.rotate(-this.angle,l.up),i.product(this.camera.viewProjMatrix,this.matStack.worldMatrix,V),z.drawTextureCube(this.tbuilder2,V,.6),this.matStack.popMatrix()}update(t,s){this.angle+=1,super.update(t,s)}render(){this.currentDrawMethod()}onKeyPress(t){super.onKeyPress(t),"1"===t.key?this.currentDrawMethod=this.drawByMatrixWithColorShader:"2"===t.key&&(this.currentDrawMethod=this.drawByMultiViewportsWithTextureShader)}}let B,k=document.getElementById("canvas");function U(){k.width=window.innerWidth,k.height=window.innerHeight}U(),window.addEventListener("resize",U);let G=document.getElementById("number");B=new F(k),B.start(),B.addTimer((()=>{G.innerText=B.fps.toFixed(1)}),0,!1)})();