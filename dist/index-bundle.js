(()=>{"use strict";var t,s,e;!function(t){t[t.MOUSEEVENT=0]="MOUSEEVENT",t[t.MOUSEDOWN=1]="MOUSEDOWN",t[t.MOUSEUP=2]="MOUSEUP",t[t.MOUSEMOVE=3]="MOUSEMOVE",t[t.MOUSEDRAG=4]="MOUSEDRAG",t[t.KEYBOARDEVENT=5]="KEYBOARDEVENT",t[t.KEYUP=6]="KEYUP",t[t.KEYDOWN=7]="KEYDOWN",t[t.KEYPRESS=8]="KEYPRESS"}(t||(t={}));class i{constructor(s=!1,e=!1,i=!1,a=t.MOUSEEVENT){this.altKey=s,this.ctrlKey=e,this.shiftKey=i,this.type=a}}class a extends i{constructor(s,e,i,a=!1,r=!1,l=!1){super(a,r,l,t.KEYBOARDEVENT),this.key=s,this.keyCode=e,this.repeat=i}}class r{constructor(t=1,s=0,e=0,i=1,a=0,r=0){this.values=new Float32Array([t,s,e,i,a,r])}static create(t=1,s=0,e=0,i=1,a=0,l=0){return new r(t,s,e,i,a,l)}static copy(t,s=null){return null===s&&(s=new r),s.values[0]=t.values[0],s.values[1]=t.values[1],s.values[2]=t.values[2],s.values[3]=t.values[3],s.values[4]=t.values[4],s.values[5]=t.values[5],s}static multiply(t,s,e=null){null===e&&(e=new r);let i=t.values[0],a=t.values[1],l=t.values[2],h=t.values[3],u=t.values[4],n=t.values[5],v=s.values[0],o=s.values[1],c=s.values[2],y=s.values[3],x=s.values[4],d=s.values[5];return e.values[0]=i*v+l*o,e.values[1]=a*v+h*o,e.values[2]=i*c+l*y,e.values[3]=a*c+h*y,e.values[4]=i*x+l*d+u,e.values[5]=a*x+h*d+n,e}static determinant(t){return t.values[0]*t.values[3]-t.values[1]*t.values[2]}static invert(t,s){let e=r.determinant(t);return!l.isEquals(e,0)&&(e=1/e,s.values[0]=t.values[3]*e,s.values[1]=-t.values[1]*e,s.values[2]=-t.values[2]*e,s.values[3]=t.values[0]*e,s.values[4]=(t.values[2]*t.values[5]-t.values[3]*t.values[4])*e,s.values[5]=(t.values[1]*t.values[4]-t.values[0]*t.values[5])*e,!0)}static makeTranslation(t,s,e=null){return null===e&&(e=new r),e.values[0]=1,e.values[1]=0,e.values[2]=0,e.values[3]=1,e.values[4]=t,e.values[5]=s,e}static makeScale(t,s,e=null){return null===e&&(e=new r),e.values[0]=t,e.values[1]=0,e.values[2]=0,e.values[3]=s,e.values[4]=0,e.values[5]=0,e}static makeRotation(t,s=null){null===s&&(s=new r);let e=Math.sin(t),i=Math.cos(t);return s.values[0]=i,s.values[1]=e,s.values[2]=-e,s.values[3]=i,s.values[4]=0,s.values[5]=0,s}static makeRotationFromVectors(t,s,e=!1,i=null){null===i&&(i=new r);let a=h.cosAngle(t,s,e),l=h.sinAngle(t,s,e);return i.values[0]=l,i.values[1]=a,i.values[2]=-l,i.values[3]=a,i.values[4]=0,i.values[5]=0,i}identity(){this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=1,this.values[4]=0,this.values[5]=0}onlyRotationMatrixInvert(){let t=this.values[1];return this.values[1]=this.values[2],this.values[2]=t,this}}class l{static toRadian(t){return t/180*Math.PI}static toDegree(t){return 180*t/Math.PI}static random(t,s){return t+Math.random()*(s-t)}static isEquals(t,s){return!(Math.abs(t-s)>Number.EPSILON)}static projectPointOnLineSegment(t,s,e,i){let a=h.create(),r=h.create(),l=0;h.difference(t,s,a),h.difference(e,s,r),l=r.normalize();let u=h.dotProduct(a,r);return u<0?(i.x=s.x,i.y=s.y,!1):u>l?(i.x=e.x,i.y=e.y,!1):(h.scaleAdd(s,r,u,i),!0)}static isPointInCircle(t,s,e){return h.difference(s,t).squaredLength<=e*e}static isPointOnLineSegement(t,s,e,i=2){let a=h.create();return!1!==l.projectPointOnLineSegment(t,s,e,a)&&l.isPointInCircle(t,a,i)}static isPointInRect(t,s,e,i,a,r){return t>=e&&t<=e+a&&s>=i&&s<=i+r}static isPointInEllipse(t,s,e,i,a,r){let l=t-e,h=s-i;return l*l/(a*a)+h*h/(r*r)<=1}static sign(t,s,e){let i=h.difference(t,e),a=h.difference(s,e);return h.crossProduct(i,a)}static isPointInTriangle(t,s,e,i){let a=l.sign(s,e,t)<0,r=l.sign(e,i,t)<0,h=l.sign(i,s,t)<0;return a===r&&r===h}static isPointInPolygon(t,s){if(s.length<3)return!1;for(let e=2;e<s.length;e++)if(l.isPointInTriangle(t,s[0],s[e-1],s[e]))return!0;return!1}static isConvex(t){let s,e,i=l.sign(t[0],t[1],t[2])<0;for(let a=1;a<t.length;a++)if(s=(a+1)%t.length,e=(a+2)%t.length,i!==l.sign(t[a],t[s],t[e])<0)return!1;return!0}static transform(t,s,e=null){return null===e&&(e=new h),e.values[0]=t.values[0]*s.values[0]+t.values[2]*s.values[1]+t.values[4],e.values[1]=t.values[1]*s.values[0]+t.values[3]*s.values[1]+t.values[5],e}static getQuadraticBezierPosition(t,s,e,i){if(i<0||i>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");let a=1-i;return a*a*t+2*i*a*s+i*i*e}static getQuadraticBezierVector(t,s,e,i,a=null){if(i<0||i>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");return null===a&&(a=new h),a.x=l.getQuadraticBezierPosition(t.x,s.x,e.x,i),a.y=l.getQuadraticBezierPosition(t.y,s.y,e.y,i),a}static getCubicBezierPosition(t,s,e,i,a){if(a<0||a>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");let r=1-a,l=a*a;return r*r*r*t+3*a*r*r*s+3*l*r*e+l*a*i}static getCubicBezierVector(t,s,e,i,a,r=null){if(a<0||a>1)throw alert("t的取值范围必须为[0,1]"),new Error("t的取值范围必须为[0,1]");return null===r&&(r=new h),r.x=l.getCubicBezierPosition(t.x,s.x,e.x,i.x,a),r.y=l.getCubicBezierPosition(t.y,s.y,e.y,i.y,a),r}}l.Colors=["aqua","black","blue","fuchsia","gray","green","lime","maroon","navy","olive","orange","purple","red","silver","teal","white","yellow"],l.matStack=new class{constructor(){this._mats=[],this._mats.push(new r)}get matrix(){if(0===this._mats.length)throw alert("矩阵堆栈为空"),new Error("矩阵堆栈为空");return this._mats[this._mats.length-1]}pushMatrix(){let t=r.copy(this.matrix);this._mats.push(t)}popMatrix(){0!==this._mats.length?this._mats.pop():alert("堆栈为空")}loadIdentity(){this.matrix.identity()}loadMatrix(t){r.copy(t,this.matrix)}multMatrix(t){r.multiply(this.matrix,t,this.matrix)}translate(t=0,s=0){let e=r.makeTranslation(t,s);this.multMatrix(e)}rotate(t=0,s=!0){!1===s&&(t=l.toRadian(t));let e=r.makeRotation(t);this.multMatrix(e)}rotateFrom(t,s,e=!1){let i=r.makeRotationFromVectors(t,s,e);this.multMatrix(i)}scale(t=1,s=1){let e=r.makeScale(t,s);this.multMatrix(e)}invert(){let t=new r;if(!1===r.invert(this.matrix,t))throw alert("堆栈顶部矩阵为奇异矩阵，无法求逆"),new Error("堆栈顶部矩阵为奇异矩阵，无法求逆");return t}};class h{constructor(t=0,s=0){this.values=new Float32Array([t,s])}static create(t=0,s=0){return new h(t,s)}static copy(t,s=null){return null===s&&(s=h.create()),s.values[0]=t.values[0],s.values[1]=t.values[1],s}static sum(t,s,e=null){return null===e&&(e=new h),e.values[0]=t.values[0]+s.values[0],e.values[1]=t.values[1]+s.values[1],e}static difference(t,s,e=null){return null===e&&(e=new h),e.values[0]=t.values[0]-s.values[0],e.values[1]=t.values[1]-s.values[1],e}static scale(t,s,e=null){return null===e&&(e=new h),e.values[0]=t.values[0]*s,e.values[1]=t.values[1]*s,e}static scaleAdd(t,s,e,i=null){return null===i&&(i=new h),i.values[0]=t.values[0]+s.values[0]*e,i.values[1]=t.values[0]+s.values[1]*e,i}static dotProduct(t,s){return t.values[0]*s.values[0]+t.values[1]*s.values[1]}static crossProduct(t,s){return t.values[0]*s.values[1]-t.values[1]*s.values[0]}static getAngle(t,s,e=!1){let i=h.dotProduct(t,s),a=Math.acos(i/(t.length*s.length));return!1===e&&(a=l.toDegree(a)),a}static getOrientation(t,s,e=!1){let i=h.difference(s,t),a=Math.atan2(i.y,i.x);return!1===e&&(a=l.toDegree(a)),a}static sinAngle(t,s,e=!1){return!0===e&&(t.normalize(),s.normalize()),t.x*s.y-s.x*t.y}static cosAngle(t,s,e=!1){return!0===e&&(t.normalize(),s.normalize()),h.dotProduct(t,s)}get x(){return this.values[0]}set x(t){this.values[0]=t}get y(){return this.values[1]}set y(t){this.values[1]=t}toString(){return"("+this.values[0]+","+this.values[1]+")"}reset(t=0,s=0){return this.values[0]=t,this.values[1]=s,this}equals(t){return!(Math.abs(this.values[0]-t.values[0])>Number.EPSILON||Math.abs(this.values[1]-t.values[1])>Number.EPSILON)}get squaredLength(){let t=this.values[0],s=this.values[1];return t*t+s*s}get length(){return Math.sqrt(this.squaredLength)}normalize(){let t=this.length;return l.isEquals(t,0)?(this.values[0]=0,this.values[1]=0,0):l.isEquals(t,1)?1:(this.values[0]/=t,this.values[1],t)}add(t){return h.sum(this,t,this)}substract(t){return h.difference(this,t,this)}negative(){return this.values[0]=-this.values[0],this.values[1]=-this.values[1],this}innerProdcut(t){return h.dotProduct(this,t)}}h.xAxis=new h(1,0),h.nXAxis=new h(-1,0),h.yAxis=new h(0,1),h.nYAxis=new h(0,-1);class u extends i{constructor(t,s,e=!1,i=!1,a=!1){super(e,i,a),this.canvasPosition=t,this.button=s,this.localPosition=h.create(),this.hasLocalPosition=!1}}class n{constructor(t){this.id=-1,this.enabled=!1,this.callbackData=void 0,this.countdown=0,this.timeout=0,this.onlyOnce=!1,this.callback=t}}class v{constructor(t,s=8){this.capacityChangedCallback=null,this._typedArrayContructor=t,this._capacity=s,0===this._capacity&&(this._capacity=8),this._arr=new this._typedArrayContructor(this._capacity),this._length=0}get length(){return this._length}get capacity(){return this._capacity}get typeArray(){return this._arr}push(t){if(this._length>=this._capacity){this._capacity>0&&(this._capacity+=this._capacity,null!==this.capacityChangedCallback&&this.capacityChangedCallback(this));let t=this._arr;this._arr=new this._typedArrayContructor(this._capacity),this._arr.set(t)}return this._arr[this._length++]=t,this._length}pushArray(t){for(let s=0;s<t.length;s++)this.push(t[s]);return this._length}subArray(t=0,s=this._length){return this._arr.subarray(t,s)}slice(t=0,s=this._length){return this._arr.slice(t,s)}clear(){this._length=0}at(t){if(t<0||t>=this.length)throw new Error("索引越界");return this._arr[t]}}class o{constructor(t,s,e){this.size=t,this.type=s,this.location=e}}class c{constructor(t,s,e){this.size=t,this.type=s,this.location=e}}!function(t){t[t.VS_SHADER=0]="VS_SHADER",t[t.FS_SAHDER=1]="FS_SAHDER"}(s||(s={})),function(t){t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35677]="SAMPLER_2D",t[t.SAMPLER_CUBE=35678]="SAMPLER_CUBE",t[t.FLOAT=5126]="FLOAT",t[t.INT=5124]="INT"}(e||(e={}));class y{static printStates(t){null!==t&&console.log(`\n        isBlendEnable = ${t.isEnabled(t.BLEND)}\n        isCullFaceEnable = ${t.isEnabled(t.CULL_FACE)}\n        isDepthTestEnable = ${t.isEnabled(t.DEPTH_TEST)}\n        isDitherEnable = ${t.isEnabled(t.DITHER)}\n        isPolygonOffsetFillEnable = ${t.isEnabled(t.POLYGON_OFFSET_FILL)}\n        isSampleAlphaToCoverageEnable = ${t.isEnabled(t.SAMPLE_ALPHA_TO_COVERAGE)} \n        isSampleCoverageEnable = ${t.isEnabled(t.SAMPLE_COVERAGE)}\n        isScissorTestEnable = ${t.isEnabled(t.SCISSOR_TEST)}\n        isStencilTestEnable = ${t.isEnabled(t.STENCIL_TEST)}\n        `)}static triggerContextLostEvent(t){let s=t.getExtension("WEBGL_lose_context");null!==s&&s.loseContext()}static printWebGLInfo(t){console.log(`\n        renderer = ${t.getParameter(t.RENDERER)}\n        version = ${t.getParameter(t.VERSION)}\n        vendor = ${t.getParameter(t.VENDOR)}\n        glsl version = ${t.getParameter(t.SHADING_LANGUAGE_VERSION)}\n        `)}static createShader(t,e){let i=null;if(i=e===s.VS_SHADER?t.createShader(t.VERTEX_SHADER):t.createShader(t.FRAGMENT_SHADER),null===i)throw new Error("shader创建失败");return i}static compileShader(t,s,e){return t.shaderSource(e,s),t.compileShader(e),!1!==t.getShaderParameter(e,t.COMPILE_STATUS)||(alert(t.getShaderInfoLog(e)),t.deleteShader(e),!1)}static createProgram(t){let s=t.createProgram();if(null===s)throw new Error("WebGLProgram创建失败");return s}static linkProgram(t,s,e,i,a=null,r=null){return t.attachShader(s,e),t.attachShader(s,i),null!==a&&a(t,s),t.linkProgram(s),!1===t.getProgramParameter(s,t.LINK_STATUS)?(alert(t.getProgramInfoLog(s)),t.detachShader(s,e),t.detachShader(s,i),t.deleteShader(e),t.deleteShader(i),t.deleteProgram(s),!1):(null!==r&&r(t,s),!0)}static getProgramActiveAttribs(t,s,e){let i=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let a=0;a<i;a++){let i=t.getActiveAttrib(s,a);i&&(e[i.name]=new o(i.size,i.type,t.getAttribLocation(s,i.name)))}}static getProgramActiveUniforms(t,s,e){let i=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let a=0;a<i;a++){let i=t.getActiveUniform(s,a);if(i){let a=t.getUniformLocation(s,i.name);a&&(e[i.name]=new c(i.size,i.type,a))}}}static createBuffer(t){let s=t.createBuffer();if(null===s)throw new Error("WebGLBuffer创建失败");return s}}class x{constructor(t){this.values=new Float32Array(3),void 0!==t&&(this.xyz=t)}get x(){return this.values[0]}get y(){return this.values[1]}get z(){return this.values[2]}get xy(){return[this.values[0],this.values[1]]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set z(t){this.values[2]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}set xyz(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}get Values(){return this.values}at(t){return this.values[t]}reset(){this.x=0,this.y=0,this.z=0}copy(t){return t||(t=new x),t.x=this.x,t.y=this.y,t.z=this.z,t}negate(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}equals(t,s=1e-5){return!(Math.abs(this.x-t.x)>s||Math.abs(this.y-t.y)>s||Math.abs(this.z-t.z)>s)}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.x,s=this.y,e=this.z;return t*t+s*s+e*e}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}scale(t,s){return s||(s=this),s.x*=t,s.y*=t,s.z*=t,s}normalize(t){t||(t=this);let s=this.length();return 1===s?this:0===s?(t.x=0,t.y=0,t.z=0,t):(s=1/s,t.x*=s,t.y*=s,t.z*=s,t)}multiplyByMat3(t,s){return s||(s=this),t.multiplyVec3(this,s)}multiplyByQuat(t,s){return s||(s=this),t.multiplyVec3(this,s)}toQuat(t){t||(t=new d);const s=new x,e=new x;return s.x=Math.cos(.5*this.x),e.x=Math.sin(.5*this.x),s.y=Math.cos(.5*this.y),e.y=Math.sin(.5*this.y),s.z=Math.cos(.5*this.z),e.z=Math.sin(.5*this.z),t.x=e.x*s.y*s.z-s.x*e.y*e.z,t.y=s.x*e.y*s.z+e.x*s.y*e.z,t.z=s.x*s.y*e.z-e.x*e.y*s.z,t.w=s.x*s.y*s.z+e.x*e.y*e.z,t}static cross(t,s,e){e||(e=new x);const i=t.x,a=t.y,r=t.z,l=s.x,h=s.y,u=s.z;return e.x=a*u-r*h,e.y=r*l-i*u,e.z=i*h-a*l,e}static dot(t,s){const e=t.x,i=t.y,a=t.z;return e*s.x+i*s.y+a*s.z}static distance(t,s){return s.x,t.x,s.y,t.y,s.z,t.z,Math.sqrt(this.squaredDistance(t,s))}static squaredDistance(t,s){const e=s.x-t.x,i=s.y-t.y,a=s.z-t.z;return e*e+i*i+a*a}static direction(t,s,e){e||(e=new x);const i=t.x-s.x,a=t.y-s.y,r=t.z-s.z;let l=Math.sqrt(i*i+a*a+r*r);return 0===l?(e.x=0,e.y=0,e.z=0,e):(l=1/l,e.x=i*l,e.y=a*l,e.z=r*l,e)}static mix(t,s,e,i){return i||(i=new x),i.x=t.x+e*(s.x-t.x),i.y=t.y+e*(s.y-t.y),i.z=t.z+e*(s.z-t.z),i}static sum(t,s,e){return e||(e=new x),e.x=t.x+s.x,e.y=t.y+s.y,e.z=t.z+s.z,e}static difference(t,s,e){return e||(e=new x),e.x=t.x-s.x,e.y=t.y-s.y,e.z=t.z-s.z,e}static product(t,s,e){return e||(e=new x),e.x=t.x*s.x,e.y=t.y*s.y,e.z=t.z*s.z,e}static quotient(t,s,e){return e||(e=new x),e.x=t.x/s.x,e.y=t.y/s.y,e.z=t.z/s.z,e}}x.zero=new x([0,0,0]),x.one=new x([1,1,1]),x.up=new x([0,1,0]),x.right=new x([1,0,0]),x.forward=new x([0,0,1]);class d{constructor(t){this.values=new Float32Array(4),void 0!==t&&(this.xyzw=t)}get x(){return this.values[0]}get y(){return this.values[1]}get z(){return this.values[2]}get w(){return this.values[3]}get xy(){return[this.values[0],this.values[1]]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}get xyzw(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set z(t){this.values[2]=t}set w(t){this.values[3]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}set xyz(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}set xyzw(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]}get Values(){return this.values}at(t){return this.values[t]}reset(){for(let t=0;t<4;t++)this.values[t]=0}copy(t){t||(t=new d);for(let s=0;s<4;s++)t.values[s]=this.values[s];return t}roll(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.atan2(2*(t*s+i*e),i*i+t*t-s*s-e*e)}pitch(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.atan2(2*(s*e+i*t),i*i-t*t-s*s+e*e)}yaw(){return Math.asin(2*(this.x*this.z-this.w*this.y))}equals(t,s=1e-5){for(let e=0;e<4;e++)if(Math.abs(this.values[e]-t.at(e))>s)return!1;return!0}setIdentity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}calculateW(){const t=this.x,s=this.y,e=this.z;return this.w=-Math.sqrt(Math.abs(1-t*t-s*s-e*e)),this}inverse(){const t=d.dot(this,this);if(!t)return this.xyzw=[0,0,0,0],this;const s=t?1/t:0;return this.x*=-s,this.y*=-s,this.z*=-s,this.w*=s,this}conjugate(){return this.values[0]*=-1,this.values[1]*=-1,this.values[2]*=-1,this}length(){const t=this.x,s=this.y,e=this.z,i=this.w;return Math.sqrt(t*t+s*s+e*e+i*i)}normalize(t){t||(t=this);const s=this.x,e=this.y,i=this.z,a=this.w;let r=Math.sqrt(s*s+e*e+i*i+a*a);return r?(r=1/r,t.x=s*r,t.y=e*r,t.z=i*r,t.w=a*r,t):(t.x=0,t.y=0,t.z=0,t.w=0,t)}add(t){for(let s=0;s<4;s++)this.values[s]+=t.at(s);return this}multiply(t){const s=this.values[0],e=this.values[1],i=this.values[2],a=this.values[3],r=t.x,l=t.y,h=t.z,u=t.w;return this.x=s*u+a*r+e*h-i*l,this.y=e*u+a*l+i*r-s*h,this.z=i*u+a*h+s*l-e*r,this.w=a*u-s*r-e*l-i*h,this}multiplyVec3(t,s){s||(s=new x);const e=t.x,i=t.y,a=t.z,r=this.x,l=this.y,h=this.z,u=this.w,n=u*e+l*a-h*i,v=u*i+h*e-r*a,o=u*a+r*i-l*e,c=-r*e-l*i-h*a;return s.x=n*u+c*-r+v*-h-o*-l,s.y=v*u+c*-l+o*-r-n*-h,s.z=o*u+c*-h+n*-l-v*-r,s}toMat3(t){t||(t=new w);const s=this.x,e=this.y,i=this.z,a=this.w,r=s+s,l=e+e,h=i+i,u=s*r,n=s*l,v=s*h,o=e*l,c=e*h,y=i*h,x=a*r,d=a*l,g=a*h;return t.init([1-(o+y),n+g,v-d,n-g,1-(u+y),c+x,v+d,c-x,1-(u+o)]),t}toMat4(t){t||(t=new p);const s=this.x,e=this.y,i=this.z,a=this.w,r=s+s,l=e+e,h=i+i,u=s*r,n=s*l,v=s*h,o=e*l,c=e*h,y=i*h,x=a*r,d=a*l,g=a*h;return t.init([1-(o+y),n+g,v-d,0,n-g,1-(u+y),c+x,0,v+d,c-x,1-(u+o),0,0,0,0,1]),t}static dot(t,s){return t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w}static sum(t,s,e){return e||(e=new d),e.x=t.x+s.x,e.y=t.y+s.y,e.z=t.z+s.z,e.w=t.w+s.w,e}static product(t,s,e){e||(e=new d);const i=t.x,a=t.y,r=t.z,l=t.w,h=s.x,u=s.y,n=s.z,v=s.w;return e.x=i*v+l*h+a*n-r*u,e.y=a*v+l*u+r*h-i*n,e.z=r*v+l*n+i*u-a*h,e.w=l*v-i*h-a*u-r*n,e}static cross(t,s,e){e||(e=new d);const i=t.x,a=t.y,r=t.z,l=t.w,h=s.x,u=s.y,n=s.z,v=s.w;return e.x=l*n+r*v+i*u-a*h,e.y=l*v-i*h-a*u-r*n,e.z=l*h+i*v+a*n-r*u,e.w=l*u+a*v+r*h-i*n,e}static shortMix(t,s,e,i){if(i||(i=new d),e<=0)return i.xyzw=t.xyzw,i;if(e>=1)return i.xyzw=s.xyzw,i;let a=d.dot(t,s);const r=s.copy();let l,h;if(a<0&&(r.inverse(),a=-a),a>.9999)l=1-e,h=0+e;else{const t=Math.sqrt(1-a*a),s=Math.atan2(t,a),i=1/t;l=Math.sin((1-e)*s)*i,h=Math.sin((0+e)*s)*i}return i.x=l*t.x+h*r.x,i.y=l*t.y+h*r.y,i.z=l*t.z+h*r.z,i.w=l*t.w+h*r.w,i}static mix(t,s,e,i){i||(i=new d);const a=t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w;if(Math.abs(a)>=1)return i.xyzw=t.xyzw,i;const r=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return i.x=.5*t.x+.5*s.x,i.y=.5*t.y+.5*s.y,i.z=.5*t.z+.5*s.z,i.w=.5*t.w+.5*s.w,i;const h=Math.sin((1-e)*r)/l,u=Math.sin(e*r)/l;return i.x=t.x*h+s.x*u,i.y=t.y*h+s.y*u,i.z=t.z*h+s.z*u,i.w=t.w*h+s.w*u,i}static fromAxisAngle(t,s,e){e||(e=new d),s*=.5;const i=Math.sin(s);return e.x=t.x*i,e.y=t.y*i,e.z=t.z*i,e.w=Math.cos(s),e}}d.identity=(new d).setIdentity();class g{constructor(t){this.values=new Float32Array(2),void 0!==t&&(this.xy=t)}get x(){return this.values[0]}get y(){return this.values[1]}get xy(){return[this.values[0],this.values[1]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}get Values(){return this.values}at(t){return this.values[t]}reset(){this.x=0,this.y=0}copy(t){return t||(t=new g),t.x=this.x,t.y=this.y,t}negate(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t}equals(t,s=1e-5){return!(Math.abs(this.x-t.x)>s||Math.abs(this.y-t.y)>s)}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.x,s=this.y;return t*t+s*s}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}divide(t){return this.x/=t.x,this.y/=t.y,this}scale(t,s){return s||(s=this),s.x*=t,s.y*=t,s}normalize(t){t||(t=this);let s=this.length();return 1===s?this:0===s?(t.x=0,t.y=0,t):(s=1/s,t.x*=s,t.y*=s,t)}multiplyMat2(t,s){return s||(s=this),t.multiplyVec2(this,s)}multiplyMat3(t,s){return s||(s=this),t.multiplyVec2(this,s)}static cross(t,s,e){e||(e=new x);const i=t.x,a=t.y,r=s.x,l=i*s.y-a*r;return e.x=0,e.y=0,e.z=l,e}static dot(t,s){return t.x*s.x+t.y*s.y}static distance(t,s){return Math.sqrt(this.squaredDistance(t,s))}static squaredDistance(t,s){const e=s.x-t.x,i=s.y-t.y;return e*e+i*i}static direction(t,s,e){e||(e=new g);const i=t.x-s.x,a=t.y-s.y;let r=Math.sqrt(i*i+a*a);return 0===r?(e.x=0,e.y=0,e):(r=1/r,e.x=i*r,e.y=a*r,e)}static mix(t,s,e,i){i||(i=new g);const a=t.x,r=t.y,l=s.x,h=s.y;return i.x=a+e*(l-a),i.y=r+e*(h-r),i}static sum(t,s,e){return e||(e=new g),e.x=t.x+s.x,e.y=t.y+s.y,e}static difference(t,s,e){return e||(e=new g),e.x=t.x-s.x,e.y=t.y-s.y,e}static product(t,s,e){return e||(e=new g),e.x=t.x*s.x,e.y=t.y*s.y,e}static quotient(t,s,e){return e||(e=new g),e.x=t.x/s.x,e.y=t.y/s.y,e}}g.zero=new g([0,0]),g.one=new g([1,1]);class w{constructor(t){this.values=new Float32Array(9),void 0!==t&&this.init(t)}get Values(){return this.values}at(t){return this.values[t]}init(t){for(let s=0;s<9;s++)this.values[s]=t[s];return this}reset(){for(let t=0;t<9;t++)this.values[t]=0}copy(t){t||(t=new w);for(let s=0;s<9;s++)t.values[s]=this.values[s];return t}all(){const t=[];for(let s=0;s<9;s++)t[s]=this.values[s];return t}row(t){return[this.values[3*t+0],this.values[3*t+1],this.values[3*t+2]]}col(t){return[this.values[t],this.values[t+3],this.values[t+6]]}equals(t,s=1e-5){for(let e=0;e<9;e++)if(Math.abs(this.values[e]-t.at(e))>s)return!1;return!0}determinant(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],a=this.values[4],r=this.values[5],l=this.values[6],h=this.values[7],u=this.values[8];return t*(u*a-r*h)+s*(-u*i+r*l)+e*(h*i-a*l)}setIdentity(){return this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=0,this.values[4]=1,this.values[5]=0,this.values[6]=0,this.values[7]=0,this.values[8]=1,this}transpose(){const t=this.values[1],s=this.values[2],e=this.values[5];return this.values[1]=this.values[3],this.values[2]=this.values[6],this.values[3]=t,this.values[5]=this.values[7],this.values[6]=s,this.values[7]=e,this}inverse(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],a=this.values[4],r=this.values[5],l=this.values[6],h=this.values[7],u=this.values[8],n=u*a-r*h,v=-u*i+r*l,o=h*i-a*l;let c=t*n+s*v+e*o;return c?(c=1/c,this.values[0]=n*c,this.values[1]=(-u*s+e*h)*c,this.values[2]=(r*s-e*a)*c,this.values[3]=v*c,this.values[4]=(u*t-e*l)*c,this.values[5]=(-r*t+e*i)*c,this.values[6]=o*c,this.values[7]=(-h*t+s*l)*c,this.values[8]=(a*t-s*i)*c,this):null}multiply(t){const s=this.values[0],e=this.values[1],i=this.values[2],a=this.values[3],r=this.values[4],l=this.values[5],h=this.values[6],u=this.values[7],n=this.values[8],v=t.at(0),o=t.at(1),c=t.at(2),y=t.at(3),x=t.at(4),d=t.at(5),g=t.at(6),w=t.at(7),m=t.at(8);return this.values[0]=v*s+o*a+c*h,this.values[1]=v*e+o*r+c*u,this.values[2]=v*i+o*l+c*n,this.values[3]=y*s+x*a+d*h,this.values[4]=y*e+x*r+d*u,this.values[5]=y*i+x*l+d*n,this.values[6]=g*s+w*a+m*h,this.values[7]=g*e+w*r+m*u,this.values[8]=g*i+w*l+m*n,this}multiplyVec2(t,s){const e=t.x,i=t.y;return s?(s.xy=[e*this.values[0]+i*this.values[3]+this.values[6],e*this.values[1]+i*this.values[4]+this.values[7]],s):new g([e*this.values[0]+i*this.values[3]+this.values[6],e*this.values[1]+i*this.values[4]+this.values[7]])}multiplyVec3(t,s){const e=t.x,i=t.y,a=t.z;return s?(s.xyz=[e*this.values[0]+i*this.values[3]+a*this.values[6],e*this.values[1]+i*this.values[4]+a*this.values[7],e*this.values[2]+i*this.values[5]+a*this.values[8]],s):new x([e*this.values[0]+i*this.values[3]+a*this.values[6],e*this.values[1]+i*this.values[4]+a*this.values[7],e*this.values[2]+i*this.values[5]+a*this.values[8]])}toMat4(t){return t?(t.init([this.values[0],this.values[1],this.values[2],0,this.values[3],this.values[4],this.values[5],0,this.values[6],this.values[7],this.values[8],0,0,0,0,1]),t):new p([this.values[0],this.values[1],this.values[2],0,this.values[3],this.values[4],this.values[5],0,this.values[6],this.values[7],this.values[8],0,0,0,0,1])}toQuat(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],a=this.values[4],r=this.values[5],l=this.values[6],h=this.values[7],u=this.values[8],n=t-a-u,v=a-t-u,o=u-t-a;let c=0,y=t+a+u;n>y&&(y=n,c=1),v>y&&(y=v,c=2),o>y&&(y=o,c=3);const x=.5*Math.sqrt(y+1),g=.25/x,w=new d;switch(c){case 0:w.w=x,w.x=(r-h)*g,w.y=(l-e)*g,w.z=(s-i)*g;break;case 1:w.w=(r-h)*g,w.x=x,w.y=(s+i)*g,w.z=(l+e)*g;break;case 2:w.w=(l-e)*g,w.x=(s+i)*g,w.y=x,w.z=(r+h)*g;break;case 3:w.w=(s-i)*g,w.x=(l+e)*g,w.y=(r+h)*g,w.z=x}return w}rotate(t,s){let e=s.x,i=s.y,a=s.z,r=Math.sqrt(e*e+i*i+a*a);if(!r)return null;1!==r&&(r=1/r,e*=r,i*=r,a*=r);const l=Math.sin(t),h=Math.cos(t),u=1-h,n=this.values[0],v=this.values[1],o=this.values[2],c=this.values[4],y=this.values[5],x=this.values[6],d=this.values[8],g=this.values[9],w=this.values[10],m=e*e*u+h,p=i*e*u+a*l,E=a*e*u-i*l,z=e*i*u-a*l,M=i*i*u+h,_=a*i*u+e*l,A=e*a*u+i*l,f=i*a*u-e*l,b=a*a*u+h;return this.values[0]=n*m+c*p+d*E,this.values[1]=v*m+y*p+g*E,this.values[2]=o*m+x*p+w*E,this.values[3]=n*z+c*M+d*_,this.values[4]=v*z+y*M+g*_,this.values[5]=o*z+x*M+w*_,this.values[6]=n*A+c*f+d*b,this.values[7]=v*A+y*f+g*b,this.values[8]=o*A+x*f+w*b,this}static product(t,s,e){const i=t.at(0),a=t.at(1),r=t.at(2),l=t.at(3),h=t.at(4),u=t.at(5),n=t.at(6),v=t.at(7),o=t.at(8),c=s.at(0),y=s.at(1),x=s.at(2),d=s.at(3),g=s.at(4),m=s.at(5),p=s.at(6),E=s.at(7),z=s.at(8);return e?(e.init([c*i+y*l+x*n,c*a+y*h+x*v,c*r+y*u+x*o,d*i+g*l+m*n,d*a+g*h+m*v,d*r+g*u+m*o,p*i+E*l+z*n,p*a+E*h+z*v,p*r+E*u+z*o]),e):new w([c*i+y*l+x*n,c*a+y*h+x*v,c*r+y*u+x*o,d*i+g*l+m*n,d*a+g*h+m*v,d*r+g*u+m*o,p*i+E*l+z*n,p*a+E*h+z*v,p*r+E*u+z*o])}}w.identity=(new w).setIdentity();class m{constructor(t){this.values=new Float32Array(4),void 0!==t&&(this.xyzw=t)}get x(){return this.values[0]}get y(){return this.values[1]}get z(){return this.values[2]}get w(){return this.values[3]}get xy(){return[this.values[0],this.values[1]]}get xyz(){return[this.values[0],this.values[1],this.values[2]]}get xyzw(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set x(t){this.values[0]=t}set y(t){this.values[1]=t}set z(t){this.values[2]=t}set w(t){this.values[3]=t}set xy(t){this.values[0]=t[0],this.values[1]=t[1]}set xyz(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}set xyzw(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]}get r(){return this.values[0]}get g(){return this.values[1]}get b(){return this.values[2]}get a(){return this.values[3]}get rg(){return[this.values[0],this.values[1]]}get rgb(){return[this.values[0],this.values[1],this.values[2]]}get rgba(){return[this.values[0],this.values[1],this.values[2],this.values[3]]}set r(t){this.values[0]=t}set g(t){this.values[1]=t}set b(t){this.values[2]=t}set a(t){this.values[3]=t}set rg(t){this.values[0]=t[0],this.values[1]=t[1]}set rgb(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]}set rgba(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]}get Values(){return this.values}at(t){return this.values[t]}reset(){this.x=0,this.y=0,this.z=0,this.w=0}copy(t){return t||(t=new m),t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t}negate(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=-this.w,t}equals(t,s=1e-5){return!(Math.abs(this.x-t.x)>s||Math.abs(this.y-t.y)>s||Math.abs(this.z-t.z)>s||Math.abs(this.w-t.w)>s)}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.x,s=this.y,e=this.z,i=this.w;return t*t+s*s+e*e+i*i}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}scale(t,s){return s||(s=this),s.x*=t,s.y*=t,s.z*=t,s.w*=t,s}normalize(t){t||(t=this);let s=this.length();return 1===s?this:0===s?(t.x*=0,t.y*=0,t.z*=0,t.w*=0,t):(s=1/s,t.x*=s,t.y*=s,t.z*=s,t.w*=s,t)}multiplyMat4(t,s){return s||(s=this),t.multiplyVec4(this,s)}static mix(t,s,e,i){return i||(i=new m),i.x=t.x+e*(s.x-t.x),i.y=t.y+e*(s.y-t.y),i.z=t.z+e*(s.z-t.z),i.w=t.w+e*(s.w-t.w),i}static sum(t,s,e){return e||(e=new m),e.x=t.x+s.x,e.y=t.y+s.y,e.z=t.z+s.z,e.w=t.w+s.w,e}static difference(t,s,e){return e||(e=new m),e.x=t.x-s.x,e.y=t.y-s.y,e.z=t.z-s.z,e.w=t.w-s.w,e}static product(t,s,e){return e||(e=new m),e.x=t.x*s.x,e.y=t.y*s.y,e.z=t.z*s.z,e.w=t.w*s.w,e}static quotient(t,s,e){return e||(e=new m),e.x=t.x/s.x,e.y=t.y/s.y,e.z=t.z/s.z,e.w=t.w/s.w,e}}m.zero=new m([0,0,0,1]),m.one=new m([1,1,1,1]);class p{constructor(t){this.values=new Float32Array(16),void 0!==t&&this.init(t)}get Values(){return this.values}at(t){return this.values[t]}init(t){for(let s=0;s<16;s++)this.values[s]=t[s];return this}reset(){for(let t=0;t<16;t++)this.values[t]=0}copy(t){t||(t=new p);for(let s=0;s<16;s++)t.values[s]=this.values[s];return t}all(){const t=[];for(let s=0;s<16;s++)t[s]=this.values[s];return t}row(t){return[this.values[4*t+0],this.values[4*t+1],this.values[4*t+2],this.values[4*t+3]]}col(t){return[this.values[t],this.values[t+4],this.values[t+8],this.values[t+12]]}equals(t,s=1e-5){for(let e=0;e<16;e++)if(Math.abs(this.values[e]-t.at(e))>s)return!1;return!0}determinant(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],a=this.values[4],r=this.values[5],l=this.values[6],h=this.values[7],u=this.values[8],n=this.values[9],v=this.values[10],o=this.values[11],c=this.values[12],y=this.values[13],x=this.values[14],d=this.values[15];return(t*r-s*a)*(v*d-o*x)-(t*l-e*a)*(n*d-o*y)+(t*h-i*a)*(n*x-v*y)+(s*l-e*r)*(u*d-o*c)-(s*h-i*r)*(u*x-v*c)+(e*h-i*l)*(u*y-n*c)}setIdentity(){return this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=0,this.values[4]=0,this.values[5]=1,this.values[6]=0,this.values[7]=0,this.values[8]=0,this.values[9]=0,this.values[10]=1,this.values[11]=0,this.values[12]=0,this.values[13]=0,this.values[14]=0,this.values[15]=1,this}transpose(){const t=this.values[1],s=this.values[2],e=this.values[3],i=this.values[6],a=this.values[7],r=this.values[11];return this.values[1]=this.values[4],this.values[2]=this.values[8],this.values[3]=this.values[12],this.values[4]=t,this.values[6]=this.values[9],this.values[7]=this.values[13],this.values[8]=s,this.values[9]=i,this.values[11]=this.values[14],this.values[12]=e,this.values[13]=a,this.values[14]=r,this}inverse(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[3],a=this.values[4],r=this.values[5],l=this.values[6],h=this.values[7],u=this.values[8],n=this.values[9],v=this.values[10],o=this.values[11],c=this.values[12],y=this.values[13],x=this.values[14],d=this.values[15],g=t*r-s*a,w=t*l-e*a,m=t*h-i*a,p=s*l-e*r,E=s*h-i*r,z=e*h-i*l,M=u*y-n*c,_=u*x-v*c,A=u*d-o*c,f=n*x-v*y,b=n*d-o*y,S=v*d-o*x;let P=g*S-w*b+m*f+p*A-E*_+z*M;return P?(P=1/P,this.values[0]=(r*S-l*b+h*f)*P,this.values[1]=(-s*S+e*b-i*f)*P,this.values[2]=(y*z-x*E+d*p)*P,this.values[3]=(-n*z+v*E-o*p)*P,this.values[4]=(-a*S+l*A-h*_)*P,this.values[5]=(t*S-e*A+i*_)*P,this.values[6]=(-c*z+x*m-d*w)*P,this.values[7]=(u*z-v*m+o*w)*P,this.values[8]=(a*b-r*A+h*M)*P,this.values[9]=(-t*b+s*A-i*M)*P,this.values[10]=(c*E-y*m+d*g)*P,this.values[11]=(-u*E+n*m-o*g)*P,this.values[12]=(-a*f+r*_-l*M)*P,this.values[13]=(t*f-s*_+e*M)*P,this.values[14]=(-c*p+y*w-x*g)*P,this.values[15]=(u*p-n*w+v*g)*P,this):null}multiply(t){const s=this.values[0],e=this.values[1],i=this.values[2],a=this.values[3],r=this.values[4],l=this.values[5],h=this.values[6],u=this.values[7],n=this.values[8],v=this.values[9],o=this.values[10],c=this.values[11],y=this.values[12],x=this.values[13],d=this.values[14],g=this.values[15];let w=t.at(0),m=t.at(1),p=t.at(2),E=t.at(3);return this.values[0]=w*s+m*r+p*n+E*y,this.values[1]=w*e+m*l+p*v+E*x,this.values[2]=w*i+m*h+p*o+E*d,this.values[3]=w*a+m*u+p*c+E*g,w=t.at(4),m=t.at(5),p=t.at(6),E=t.at(7),this.values[4]=w*s+m*r+p*n+E*y,this.values[5]=w*e+m*l+p*v+E*x,this.values[6]=w*i+m*h+p*o+E*d,this.values[7]=w*a+m*u+p*c+E*g,w=t.at(8),m=t.at(9),p=t.at(10),E=t.at(11),this.values[8]=w*s+m*r+p*n+E*y,this.values[9]=w*e+m*l+p*v+E*x,this.values[10]=w*i+m*h+p*o+E*d,this.values[11]=w*a+m*u+p*c+E*g,w=t.at(12),m=t.at(13),p=t.at(14),E=t.at(15),this.values[12]=w*s+m*r+p*n+E*y,this.values[13]=w*e+m*l+p*v+E*x,this.values[14]=w*i+m*h+p*o+E*d,this.values[15]=w*a+m*u+p*c+E*g,this}multiplyVec3(t){const s=t.x,e=t.y,i=t.z;return new x([this.values[0]*s+this.values[4]*e+this.values[8]*i+this.values[12],this.values[1]*s+this.values[5]*e+this.values[9]*i+this.values[13],this.values[2]*s+this.values[6]*e+this.values[10]*i+this.values[14]])}multiplyVec4(t,s){s||(s=new m);const e=t.x,i=t.y,a=t.z,r=t.w;return s.x=this.values[0]*e+this.values[4]*i+this.values[8]*a+this.values[12]*r,s.y=this.values[1]*e+this.values[5]*i+this.values[9]*a+this.values[13]*r,s.z=this.values[2]*e+this.values[6]*i+this.values[10]*a+this.values[14]*r,s.w=this.values[3]*e+this.values[7]*i+this.values[11]*a+this.values[15]*r,s}toMat3(){return new w([this.values[0],this.values[1],this.values[2],this.values[4],this.values[5],this.values[6],this.values[8],this.values[9],this.values[10]])}toInverseMat3(){const t=this.values[0],s=this.values[1],e=this.values[2],i=this.values[4],a=this.values[5],r=this.values[6],l=this.values[8],h=this.values[9],u=this.values[10],n=u*a-r*h,v=-u*i+r*l,o=h*i-a*l;let c=t*n+s*v+e*o;return c?(c=1/c,new w([n*c,(-u*s+e*h)*c,(r*s-e*a)*c,v*c,(u*t-e*l)*c,(-r*t+e*i)*c,o*c,(-h*t+s*l)*c,(a*t-s*i)*c])):null}translate(t){const s=t.x,e=t.y,i=t.z;return this.values[12]+=this.values[0]*s+this.values[4]*e+this.values[8]*i,this.values[13]+=this.values[1]*s+this.values[5]*e+this.values[9]*i,this.values[14]+=this.values[2]*s+this.values[6]*e+this.values[10]*i,this.values[15]+=this.values[3]*s+this.values[7]*e+this.values[11]*i,this}scale(t){const s=t.x,e=t.y,i=t.z;return this.values[0]*=s,this.values[1]*=s,this.values[2]*=s,this.values[3]*=s,this.values[4]*=e,this.values[5]*=e,this.values[6]*=e,this.values[7]*=e,this.values[8]*=i,this.values[9]*=i,this.values[10]*=i,this.values[11]*=i,this}rotate(t,s){let e=s.x,i=s.y,a=s.z,r=Math.sqrt(e*e+i*i+a*a);if(!r)return null;1!==r&&(r=1/r,e*=r,i*=r,a*=r);const l=Math.sin(t),h=Math.cos(t),u=1-h,n=this.values[0],v=this.values[1],o=this.values[2],c=this.values[3],y=this.values[4],x=this.values[5],d=this.values[6],g=this.values[7],w=this.values[8],m=this.values[9],p=this.values[10],E=this.values[11],z=e*e*u+h,M=i*e*u+a*l,_=a*e*u-i*l,A=e*i*u-a*l,f=i*i*u+h,b=a*i*u+e*l,S=e*a*u+i*l,P=i*a*u-e*l,T=a*a*u+h;return this.values[0]=n*z+y*M+w*_,this.values[1]=v*z+x*M+m*_,this.values[2]=o*z+d*M+p*_,this.values[3]=c*z+g*M+E*_,this.values[4]=n*A+y*f+w*b,this.values[5]=v*A+x*f+m*b,this.values[6]=o*A+d*f+p*b,this.values[7]=c*A+g*f+E*b,this.values[8]=n*S+y*P+w*T,this.values[9]=v*S+x*P+m*T,this.values[10]=o*S+d*P+p*T,this.values[11]=c*S+g*P+E*T,this}static frustum(t,s,e,i,a,r){const l=s-t,h=i-e,u=r-a;return new p([2*a/l,0,0,0,0,2*a/h,0,0,(s+t)/l,(i+e)/h,-(r+a)/u,-1,0,0,-r*a*2/u,0])}static perspective(t,s,e,i){const a=e*Math.tan(t*Math.PI/360),r=a*s;return p.frustum(-r,r,-a,a,e,i)}static orthographic(t,s,e,i,a,r){const l=s-t,h=i-e,u=r-a;return new p([2/l,0,0,0,0,2/h,0,0,0,0,-2/u,0,-(t+s)/l,-(i+e)/h,-(r+a)/u,1])}static lookAt(t,s,e=x.up){if(t.equals(s))return this.identity;const i=x.difference(t,s).normalize(),a=x.cross(e,i).normalize(),r=x.cross(i,a).normalize();return new p([a.x,r.x,i.x,0,a.y,r.y,i.y,0,a.z,r.z,i.z,0,-x.dot(a,t),-x.dot(r,t),-x.dot(i,t),1])}static product(t,s,e){const i=t.at(0),a=t.at(1),r=t.at(2),l=t.at(3),h=t.at(4),u=t.at(5),n=t.at(6),v=t.at(7),o=t.at(8),c=t.at(9),y=t.at(10),x=t.at(11),d=t.at(12),g=t.at(13),w=t.at(14),m=t.at(15),E=s.at(0),z=s.at(1),M=s.at(2),_=s.at(3),A=s.at(4),f=s.at(5),b=s.at(6),S=s.at(7),P=s.at(8),T=s.at(9),L=s.at(10),O=s.at(11),R=s.at(12),C=s.at(13),I=s.at(14),V=s.at(15);return e?(e.init([E*i+z*h+M*o+_*d,E*a+z*u+M*c+_*g,E*r+z*n+M*y+_*w,E*l+z*v+M*x+_*m,A*i+f*h+b*o+S*d,A*a+f*u+b*c+S*g,A*r+f*n+b*y+S*w,A*l+f*v+b*x+S*m,P*i+T*h+L*o+O*d,P*a+T*u+L*c+O*g,P*r+T*n+L*y+O*w,P*l+T*v+L*x+O*m,R*i+C*h+I*o+V*d,R*a+C*u+I*c+V*g,R*r+C*n+I*y+V*w,R*l+C*v+I*x+V*m]),e):new p([E*i+z*h+M*o+_*d,E*a+z*u+M*c+_*g,E*r+z*n+M*y+_*w,E*l+z*v+M*x+_*m,A*i+f*h+b*o+S*d,A*a+f*u+b*c+S*g,A*r+f*n+b*y+S*w,A*l+f*v+b*x+S*m,P*i+T*h+L*o+O*d,P*a+T*u+L*c+O*g,P*r+T*n+L*y+O*w,P*l+T*v+L*x+O*m,R*i+C*h+I*o+V*d,R*a+C*u+I*c+V*g,R*r+C*n+I*y+V*w,R*l+C*v+I*x+V*m])}}p.identity=(new p).setIdentity();let E=document.getElementById("canvas");function z(){E.width=window.innerWidth,E.height=window.innerHeight}z(),window.addEventListener("resize",z);let M=document.getElementById("number"),_=new class extends class{constructor(t){this._timeId=-1,this._fps=0,this._start=!1,this._requestId=-1,this.timers=[],this.canvas=t,this.canvas.addEventListener("mousedown",this,!1),this.canvas.addEventListener("mouseup",this,!1),this.canvas.addEventListener("mousemove",this,!1),window.addEventListener("keydown",this,!1),window.addEventListener("keyup",this,!1),window.addEventListener("keypress",this,!1),this._isMouseDonw=!1,this.isSupportMouseMove=!1}get fps(){return this._fps}_viewportToCanvasCoordinate(t){if(this.canvas){let s=this.canvas.getBoundingClientRect();if(t.target){let e=0,i=0,a=0,r=0,l=window.getComputedStyle(t.target),u=l.borderLeftWidth;null!==u&&(e=parseInt(u,10)),u=l.borderTopWidth,null!==u&&(i=parseInt(u,10)),u=l.paddingLeft,null!==u&&(a=parseInt(u,10)),u=l.paddingTop,null!==u&&(r=parseInt(u,10));let n=t.clientX-s.left-e-a,v=t.clientY-s.top-i-r;return h.create(n,v)}}throw alert("canvas未设置"),new Error("canvas未设置")}_toCanvasMouseEvent(t){let s=t,e=this._viewportToCanvasCoordinate(s);return new u(e,s.button,s.altKey,s.ctrlKey,s.shiftKey)}_toCanvasKeyBoardEvent(t){let s=t;return new a(s.key,s.keyCode,s.repeat,s.altKey,s.ctrlKey,s.shiftKey)}_handleTimers(t){for(let s=0;s<this.timers.length;s++){let e=this.timers[s];!1!==e.enabled&&(e.countdown-=t,e.countdown<0&&(e.callback(e.id,e.callbackData),!1===e.onlyOnce?e.countdown=e.timeout:this.removeTimer(e.id)))}}dispatchMouseDown(s){s.type=t.MOUSEDOWN}dispatchMouseUp(s){s.type=t.MOUSEUP}dispatchMouseMove(s){s.type=t.MOUSEMOVE}dispatchMouseDrag(s){s.type=t.MOUSEDRAG}dispatchKeyPress(s){s.type=t.KEYPRESS}dispatchKeyDown(s){s.type=t.KEYDOWN}dispatchKeyUp(s){s.type=t.KEYUP}addTimer(t,s=1,e=!1,i){let a;for(let r=0;r<this.timers.length;r++)if(a=this.timers[r],!1===a.enabled)return a.callback=t,a.callbackData=i,a.timeout=s,a.countdown=s,a.enabled=!0,a.onlyOnce=e,a.id;return a=new n(t),a.callbackData=i,a.timeout=s,a.countdown=s,a.enabled=!0,a.id=++this._timeId,a.onlyOnce=e,this.timers.push(a),a.id}removeTimer(t){let s=!1;for(let e=0;e<this.timers.length;e++)if(this.timers[e].id===t){this.timers[e].enabled=!1,s=!0;break}return s}handleEvent(t){switch(t.type){case"mousedown":this._isMouseDonw=!0,this.dispatchMouseDown(this._toCanvasMouseEvent(t));break;case"mouseup":this._isMouseDonw=!1,this.dispatchMouseUp(this._toCanvasMouseEvent(t));break;case"mousemove":this.isSupportMouseMove&&this.dispatchMouseMove(this._toCanvasMouseEvent(t)),this._isMouseDonw&&this.dispatchMouseDrag(this._toCanvasMouseEvent(t));break;case"keypress":this.dispatchKeyPress(this._toCanvasKeyBoardEvent(t));break;case"keydown":this.dispatchKeyDown(this._toCanvasKeyBoardEvent(t));break;case"keyup":this.dispatchKeyUp(this._toCanvasKeyBoardEvent(t))}}start(){this._start||(this._start=!0,this._requestId=-1,this._startTime=-1,this._lastTime=-1,this._requestId=requestAnimationFrame((t=>{this.step(t)})))}stop(){this._start&&(cancelAnimationFrame(this._requestId),this._requestId=-1,this._lastTime=-1,this._startTime=-1,this._start=!1)}isRunning(){return this._start}step(t){-1===this._startTime&&(this._startTime=t),-1===this._lastTime&&(this._lastTime=t);let s=t-this._startTime,e=t-this._lastTime;0!==e&&(this._fps=1e3/e),e/=1e3,this._lastTime=t,this._handleTimers(e),this.update(s,e),this.render(),this._requestId=requestAnimationFrame((t=>{this.step(t)}))}update(t,s){}render(){}}{constructor(t){super(t),this.colorShader_vs="\n        attribute mediump vec3 aPosition;\n        attribute mediump vec4 aColor;\n        uniform mediump mat4 uMVPMatrix;\n        varying lowp vec4 vColor;\n        void main(){\n            gl_Position = uMVPMatrix*vec4(aPosition,1.0);\n            gl_PointSize = 5.0;\n            vColor = aColor;\n        }\n    ",this.colorShader_fs="\n        varying lowp vec4 vColor;\n        void main(){\n            gl_FragColor = vColor;\n        }\n    ",this.attribMap={},this.uniformMap={},t.addEventListener("webglcontextlost",(function(t){console.log(JSON.stringify(t))}),!1);let e=this.canvas.getContext("webgl",{depth:!0,stencil:!0,alpha:!0,premultipliedAlpha:!0,antialias:!0,preserveDrawingBuffer:!1});if(null===e)throw alert("无法创建WebGLRenderingContext上下文对象"),new Error("无法创建WebGLRenderingContext上下文对象");this.gl=e,this.projectMatrix=p.perspective(45,this.canvas.width/this.canvas.height,.1,100),this.viewMatrix=p.lookAt(new x([0,0,5]),new x),this.viewProjectMatrix=p.product(this.projectMatrix,this.viewMatrix),console.log(this.viewProjectMatrix.multiplyVec4(new m([.5,.5,0,1]))),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.scissor(0,0,this.canvas.width,this.canvas.height),this.gl.enable(this.gl.SCISSOR_TEST),this.vsShader=y.createShader(this.gl,s.VS_SHADER),y.compileShader(this.gl,this.colorShader_vs,this.vsShader),this.fsShader=y.createShader(this.gl,s.FS_SAHDER),y.compileShader(this.gl,this.colorShader_fs,this.fsShader),this.program=y.createProgram(this.gl),y.linkProgram(this.gl,this.program,this.vsShader,this.fsShader,this.printProgramActiveInfos.bind(this),this.printProgramActiveInfos.bind(this))&&this.printProgramActiveInfos(),this.ivbo=y.createBuffer(this.gl),this.verts=new v(Float32Array,42),this.indices=new v(Uint16Array,6),this.evbo=y.createBuffer(this.gl),this.drawRectByInterLeavedVBOWithEBO(0,6)}drawRectByInterLeavedVBOWithEBO(t,s,e=this.gl.TRIANGLES){if(this.verts.clear(),this.verts.pushArray([-.5,-.5,0,1,0,0,1,.5,-.5,0,0,1,0,1,.5,.5,0,0,0,1,0,-.5,.5,0,0,1,0,1]),this.indices.clear(),e===this.gl.TRIANGLES||e===this.gl.TRIANGLE_FAN)this.indices.pushArray([0,1,2,0,2,3]);else{if(e!==this.gl.TRIANGLE_STRIP)return;this.indices.pushArray([0,1,2,2,3,0])}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.ivbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.verts.subArray(),this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.attribMap.aPosition.location,3,this.gl.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0),this.gl.vertexAttribPointer(this.attribMap.aColor.location,4,this.gl.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,12),this.gl.enableVertexAttribArray(this.attribMap.aPosition.location),this.gl.enableVertexAttribArray(this.attribMap.aColor.location),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.evbo),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indices.subArray(),this.gl.DYNAMIC_DRAW),this.gl.useProgram(this.program);let i=(new p).setIdentity().scale(new x([2,2,2]));p.product(this.viewProjectMatrix,i,i),this.gl.uniformMatrix4fv(this.uniformMap.uMVPMatrix.location,!1,i.Values),this.gl.drawElements(e,s,this.gl.UNSIGNED_SHORT,t),this.gl.useProgram(null),this.gl.disableVertexAttribArray(this.attribMap.aPostion),this.gl.disableVertexAttribArray(this.attribMap.aColor),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}drawRetcByInterLeavedVBO(t,s,e=this.gl.TRIANGLES){let i;this.verts.clear(),this.verts.clear(),i=e===this.gl.TRIANGLES?[-.5,-.5,0,1,0,0,1,.5,-.5,0,0,1,0,1,.5,.5,0,0,0,1,0,.5,.5,0,0,0,1,0,-.5,.5,0,0,1,0,1,-.5,-.5,0,1,0,0,1]:[-.5,-.5,0,1,0,0,1,.5,-.5,0,0,1,0,1,.5,.5,0,0,0,1,0,-.5,.5,0,0,1,0,1],this.verts.pushArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.ivbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.verts.subArray(),this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.attribMap.aPosition.location,3,this.gl.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0),this.gl.vertexAttribPointer(this.attribMap.aColor.location,4,this.gl.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,12),this.gl.enableVertexAttribArray(this.attribMap.aPosition.location),this.gl.enableVertexAttribArray(this.attribMap.aColor.location),this.gl.useProgram(this.program),this.gl.uniformMatrix4fv(this.uniformMap.uMVPMatrix.location,!1,this.viewProjectMatrix.Values),this.gl.drawArrays(e,t,s),this.gl.useProgram(null),this.gl.disableVertexAttribArray(this.attribMap.aPostion),this.gl.disableVertexAttribArray(this.attribMap.aColor),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}printProgramActiveInfos(){y.getProgramActiveAttribs(this.gl,this.program,this.attribMap),y.getProgramActiveUniforms(this.gl,this.program,this.uniformMap),console.log(`\n        attribMap: ${JSON.stringify(this.attribMap)}\n        uniforms: ${JSON.stringify(this.uniformMap)}\n        `)}}(E);_.addTimer((()=>{M.innerText=_.fps.toFixed(1)}),0,!1)})();